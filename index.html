<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Muhammad Junaid Abid - Portfolio</title>
    <meta name="description" content="Portfolio of Muhammad Junaid Abid - Project & Product Manager">

    <!-- External Libraries -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        cyan: { 400: '#06b6d4', 500: '#06b6d4', 600: '#0891b2' },
                        slate: { 850: '#151f32', 900: '#0f172a' },
                        primary: '#06b6d4',
                        secondary: '#a855f7',
                        accent: '#10b981',
                        bg: '#0f172a',
                        'bg-secondary': '#1e293b',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['Fira Code', 'monospace'],
                        inter: ['Inter', 'sans-serif'],
                        fira: ['Fira Code', 'monospace']
                    }
                }
            }
        }
    </script>

    <style>
        :root {
            --primary-color: #06b6d4;
            --primary-rgb: 6, 182, 212;
            --secondary-color: #a855f7;
            --secondary-rgb: 168, 85, 247;
            --accent-color: #10b981;
            --accent-rgb: 16, 185, 129;
            --bg-color: #0f172a;
            --bg-secondary: #1e293b;
            --glow-intensity: 1;
            --animation-speed: 1;
        }
        
        *, *::before, *::after {
            cursor: none !important;
        }
        
        html { scroll-behavior: smooth; }
        
        body { 
            background: radial-gradient(circle at 50% 50%, #0f172a 0%, #020617 100%);
            background-color: var(--bg-color); 
            color: white; 
            overflow-x: hidden;
            font-family: 'Inter', sans-serif;
        }

        /* FLUID LAYER CSS */
        #fluid-layer {
            position: fixed;
            inset: 0;
            z-index: 0; /* Behind content */
            mix-blend-mode: screen;
            opacity: 1.0;
            pointer-events: none;
        }
        
        ::selection {
            background: var(--primary-color);
            color: white;
        }
        
        .glass { 
            background: rgba(30, 41, 59, 0.7); 
            backdrop-filter: blur(16px); 
            -webkit-backdrop-filter: blur(16px); 
            border: 1px solid rgba(255, 255, 255, 0.08); 
        }
        
        .glass-strong {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }
        
        /* Custom Cursor - Highest Z-Index Fix */
        #cursor-dot, #cursor-outline { 
            position: fixed; 
            top: 0; left: 0; 
            transform: translate(-50%, -50%); 
            border-radius: 50%; 
            z-index: 2147483647; /* Maximum possible z-index */
            pointer-events: none;
            will-change: transform, width, height;
            transition: opacity 0.3s;
        }
        #cursor-dot { 
            width: 10px; height: 10px; 
            background: var(--primary-color);
            box-shadow: 0 0 20px var(--primary-color), 0 0 40px var(--primary-color);
            mix-blend-mode: screen;
        }
        #cursor-outline { 
            width: 45px; height: 45px; 
            border: 2px solid var(--primary-color); 
            transition: all 0.2s cubic-bezier(0.16, 1, 0.3, 1);
            opacity: 0.6;
        }
        #cursor-outline.hover {
            width: 70px; height: 70px;
            background: rgba(var(--primary-rgb), 0.15);
            border-width: 3px;
            opacity: 1;
        }
        #cursor-outline.clicking {
            width: 35px; height: 35px;
            background: rgba(var(--primary-rgb), 0.4);
        }
        #cursor-outline.text-hover {
            width: 4px; height: 35px;
            border-radius: 2px;
            border: none;
            background: var(--primary-color);
        }
        
        .cursor-trail {
            position: fixed;
            width: 6px; height: 6px;
            background: var(--primary-color);
            border-radius: 50%;
            pointer-events: none;
            z-index: 2147483646;
            opacity: 0.5;
            animation: trailFade 0.6s ease-out forwards;
        }
        
        @keyframes trailFade {
            to { opacity: 0; transform: scale(0); }
        }
        
        /* Magnetic Effect for Buttons */
        .magnetic-btn {
            transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }
        
        /* Editable Styles - Admin Only */
        .editable-highlight { 
            position: relative;
            border: 2px dashed rgba(var(--primary-rgb), 0.6);
            padding: 8px;
            border-radius: 10px;
            transition: all 0.3s ease;
            background: rgba(var(--primary-rgb), 0.03);
            z-index: 20;
        }
        .editable-highlight:hover { 
            background: rgba(var(--primary-rgb), 0.12);
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(var(--primary-rgb), 0.2);
        }
        .editable-highlight::after { 
            content: '✏️ Edit'; 
            position: absolute; 
            top: -25px; right: 0; 
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); 
            color: white; 
            padding: 4px 10px;
            border-radius: 15px; 
            font-size: 10px;
            font-weight: 700;
            opacity: 0;
            transform: translateY(5px);
            transition: all 0.3s ease;
            pointer-events: none;
            white-space: nowrap;
            box-shadow: 0 4px 15px rgba(var(--primary-rgb), 0.4);
        }
        .editable-highlight:hover::after { 
            opacity: 1;
            transform: translateY(0);
        }

        /* Media Editable */
        .media-editable { position: relative; overflow: hidden; border-radius: 12px; }
        .media-editable:hover .media-overlay { opacity: 1; }
        .media-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(0,0,0,0.85), rgba(0,0,0,0.7));
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            opacity: 0;
            transition: opacity 0.3s ease;
            border-radius: inherit;
        }
        .media-btn {
            width: 44px; height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            border: 2px solid rgba(255,255,255,0.2);
        }
        .media-btn:hover {
            transform: scale(1.2) rotate(5deg);
            box-shadow: 0 0 25px currentColor;
        }

        /* Text Glow */
        .text-glow {
            text-shadow: 
                0 0 10px rgba(var(--primary-rgb), 0.3),
                0 0 30px rgba(var(--primary-rgb), 0.2),
                0 0 50px rgba(var(--primary-rgb), 0.1);
        }

        .text-gradient {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Glow Effects */
        .shadow-glow {
            box-shadow: 
                0 0 20px rgba(var(--primary-rgb), 0.3),
                0 10px 40px rgba(var(--primary-rgb), 0.2);
        }
        
        .shadow-glow-hover:hover {
            box-shadow: 
                0 0 30px rgba(var(--primary-rgb), 0.5),
                0 15px 50px rgba(var(--primary-rgb), 0.3);
        }

        /* Stars Background */
        .stars {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 0;
        }
        
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle calc(2s / var(--animation-speed)) infinite ease-in-out;
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.2; transform: scale(0.8); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        .nebula {
            position: fixed;
            border-radius: 50%;
            filter: blur(100px);
            opacity: calc(0.12 * var(--glow-intensity));
            pointer-events: none;
            z-index: 0;
            animation: nebulaPulse 8s ease-in-out infinite;
        }
        
        @keyframes nebulaPulse {
            0%, 100% { transform: scale(1); opacity: calc(0.12 * var(--glow-intensity)); }
            50% { transform: scale(1.1); opacity: calc(0.18 * var(--glow-intensity)); }
        }

        .shooting-star {
            position: fixed;
            height: 2px;
            background: linear-gradient(90deg, white, transparent);
            animation: shoot calc(0.8s / var(--animation-speed)) linear forwards;
            z-index: 0;
            pointer-events: none;
            border-radius: 100px;
        }
        
        @keyframes shoot {
            from { transform: translateX(0) translateY(0); opacity: 1; }
            to { transform: translateX(-400px) translateY(400px); opacity: 0; }
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: var(--bg-color); }
        ::-webkit-scrollbar-thumb { 
            background: linear-gradient(var(--primary-color), var(--secondary-color)); 
            border-radius: 5px;
        }
        ::-webkit-scrollbar-thumb:hover { background: var(--primary-color); }

        /* Projects Grid */
        .projects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(360px, 1fr));
            gap: 2rem;
        }

        /* Settings Panel */
        .settings-wheel {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
        }

        .settings-btn {
            width: 60px; height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.95), rgba(15, 23, 42, 0.95));
            border: 2px solid rgba(var(--primary-rgb), 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 0 5px 25px rgba(0,0,0,0.3), 0 0 30px rgba(var(--primary-rgb), 0.2);
        }

        .settings-btn:hover {
            transform: rotate(180deg) scale(1.1);
            border-color: var(--primary-color);
            box-shadow: 0 5px 35px rgba(var(--primary-rgb), 0.5);
        }

        .settings-panel {
            position: absolute;
            bottom: 75px;
            right: 0;
            width: 380px;
            max-height: 85vh;
            overflow-y: auto;
            padding: 24px;
            border-radius: 24px;
            transform-origin: bottom right;
            border: 1px solid rgba(var(--primary-rgb), 0.2);
            z-index: 1001;
        }

        /* Mobile Menu */
        @media (max-width: 768px) {
            .mobile-menu {
                position: fixed;
                inset: 0;
                background: rgba(15, 23, 42, 0.98);
                backdrop-filter: blur(20px);
                z-index: 100;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                gap: 2.5rem;
            }
            .projects-grid { grid-template-columns: 1fr; }
            .floating-admin-panel { display: none !important; }
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.92);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow-y: auto;
            backdrop-filter: blur(12px);
        }

        .modal-content {
            max-width: 950px;
            width: 100%;
            max-height: 92vh;
            overflow-y: auto;
            border-radius: 28px;
            border: 1px solid rgba(var(--primary-rgb), 0.15);
        }

        /* Image Gallery */
        .image-gallery {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .image-gallery img, .image-gallery video {
            width: 100%;
            height: 130px;
            object-fit: cover;
            border-radius: 14px;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            border: 2px solid transparent;
        }

        .image-gallery img:hover, .image-gallery video:hover {
            transform: scale(1.08) rotate(1deg);
            border-color: var(--primary-color);
            box-shadow: 0 10px 30px rgba(var(--primary-rgb), 0.3);
        }

        /* Tags */
        .skill-tag {
            background: linear-gradient(135deg, rgba(var(--primary-rgb), 0.2), rgba(var(--primary-rgb), 0.1));
            color: var(--primary-color);
            border: 1px solid rgba(var(--primary-rgb), 0.35);
            transition: all 0.3s ease;
        }
        .skill-tag:hover {
            background: rgba(var(--primary-rgb), 0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(var(--primary-rgb), 0.3);
        }

        .tool-tag {
            background: linear-gradient(135deg, rgba(var(--secondary-rgb), 0.2), rgba(var(--secondary-rgb), 0.1));
            color: var(--secondary-color);
            border: 1px solid rgba(var(--secondary-rgb), 0.35);
        }
        .tool-tag:hover {
            background: rgba(var(--secondary-rgb), 0.3);
            transform: translateY(-2px);
        }

        /* Profile Image */
        .profile-image-container { position: relative; }
        .profile-image-container:hover .profile-overlay { opacity: 1; }
        .profile-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.85);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 12px;
            opacity: 0;
            transition: all 0.4s ease;
            border-radius: 50%;
        }

        /* Upload Zone */
        .upload-zone {
            border: 3px dashed rgba(var(--primary-rgb), 0.4);
            border-radius: 20px;
            padding: 45px;
            text-align: center;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            background: rgba(var(--primary-rgb), 0.03);
        }
        .upload-zone:hover, .upload-zone.dragover {
            border-color: var(--primary-color);
            background: rgba(var(--primary-rgb), 0.1);
            transform: scale(1.02);
            box-shadow: 0 0 40px rgba(var(--primary-rgb), 0.2);
        }

        /* Media Grid */
        .media-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 18px;
            margin-top: 24px;
        }

        .media-item {
            position: relative;
            border-radius: 16px;
            overflow: hidden;
            aspect-ratio: 16/10;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        .media-item:hover {
            border-color: var(--primary-color);
            transform: translateY(-4px);
        }

        .media-item img, .media-item video {
            width: 100%; height: 100%;
            object-fit: cover;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%) translateY(120px);
            padding: 18px 36px;
            border-radius: 50px;
            font-weight: 600;
            z-index: 100001;
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 0 10px 40px rgba(0,0,0,0.4);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
        .toast.success { background: linear-gradient(135deg, #10b981, #059669); }
        .toast.error { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .toast.info { background: linear-gradient(135deg, #3b82f6, #2563eb); }
        .toast.warning { background: linear-gradient(135deg, #f59e0b, #d97706); }

        /* Buttons */
        .add-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 16px 28px;
            border: 2px dashed rgba(var(--primary-rgb), 0.5);
            border-radius: 16px;
            color: var(--primary-color);
            font-weight: 700;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            background: rgba(var(--primary-rgb), 0.05);
        }
        .add-btn:hover {
            border-style: solid;
            background: rgba(var(--primary-rgb), 0.15);
            transform: scale(1.02);
            box-shadow: 0 10px 30px rgba(var(--primary-rgb), 0.2);
        }

        .delete-btn {
            position: absolute;
            top: -10px; right: -10px;
            width: 32px; height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            z-index: 50;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.5);
            cursor: pointer !important;
        }
        .editable-highlight:hover .delete-btn,
        .group:hover .delete-btn {
            opacity: 1;
        }
        .delete-btn:hover {
            transform: scale(1.25) rotate(90deg);
        }

        /* Video Hover Play */
        .video-container {
            position: relative;
            border-radius: 16px;
            overflow: hidden;
            transition: all 0.4s ease;
        }
        .video-container:hover {
            transform: scale(1.01);
            box-shadow: 0 15px 50px rgba(var(--primary-rgb), 0.3);
        }
        .video-play-icon {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0,0,0,0.4);
            transition: all 0.3s ease;
        }
        .video-container:hover .video-play-icon {
            background: rgba(0,0,0,0.2);
        }
        .video-play-icon span {
            width: 70px; height: 70px;
            border-radius: 50%;
            background: rgba(255,255,255,0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            transition: all 0.3s ease;
            box-shadow: 0 5px 25px rgba(0,0,0,0.3);
        }
        .video-container:hover .video-play-icon span {
            transform: scale(1.1);
        }

        /* Floating Admin Panel */
        .floating-admin-panel {
            position: fixed;
            left: 24px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 999;
            display: flex;
            flex-direction: column;
            gap: 14px;
        }

        .fab-btn {
            width: 52px; height: 52px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden;
        }
        .fab-btn::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.2), transparent);
            opacity: 0;
            transition: opacity 0.3s;
        }
        .fab-btn:hover::before {
            opacity: 1;
        }
        .fab-btn:hover {
            transform: scale(1.15) translateX(5px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.4);
        }
        .fab-btn[data-tooltip]:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            left: 65px;
            background: var(--bg-secondary);
            color: white;
            padding: 8px 14px;
            border-radius: 8px;
            font-size: 12px;
            white-space: nowrap;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        /* Particle Effects */
        .particle {
            position: fixed;
            pointer-events: none;
            z-index: 99997;
            border-radius: 50%;
        }
        
        @keyframes particleFloat {
            0% { transform: translate(0, 0) scale(1); opacity: 1; }
            100% { transform: translate(var(--tx), var(--ty)) scale(0); opacity: 0; }
        }

        /* Color Swatches */
        .color-swatch {
            width: 36px; height: 36px;
            border-radius: 50%;
            border: 3px solid transparent;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
        }
        .color-swatch:hover, .color-swatch.active {
            transform: scale(1.25);
            border-color: white;
            box-shadow: 0 0 20px currentColor;
        }
        .color-swatch.active::after {
            content: '✓';
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
        }

        /* Typing Animation */
        .typing-animation {
            overflow: hidden;
            border-right: 3px solid var(--primary-color);
            white-space: nowrap;
            animation: typing 3s steps(40) forwards, blink 0.7s step-end infinite;
        }
        @keyframes typing {
            from { width: 0; }
            to { width: 100%; }
        }
        @keyframes blink {
            50% { border-color: transparent; }
        }

        /* Reveal Animation */
        .reveal {
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.8s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .reveal.active {
            opacity: 1;
            transform: translateY(0);
        }

        /* Hover Card Tilt */
        .tilt-card {
            transform-style: preserve-3d;
            transition: transform 0.3s ease;
        }

        /* Social Links */
        .social-link {
            width: 50px; height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            background: rgba(var(--primary-rgb), 0.1);
            border: 2px solid rgba(var(--primary-rgb), 0.3);
            text-decoration: none;
            color: white;
            position: relative;
            z-index: 10;
        }
        .social-link:hover {
            background: var(--primary-color);
            transform: translateY(-5px) scale(1.1);
            box-shadow: 0 10px 30px rgba(var(--primary-rgb), 0.4);
        }

        /* Progress Bar Animation */
        .progress-bar {
            height: 6px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border-radius: 3px;
            transform-origin: left;
            animation: progressFill 1.5s ease-out forwards;
        }
        @keyframes progressFill {
            from { transform: scaleX(0); }
            to { transform: scaleX(1); }
        }

        /* Surprise Animations */
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-15px) rotate(3deg); }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        
        .shimmer-text {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color), var(--primary-color));
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: shimmer 3s linear infinite;
        }
        
        .float-animation {
            animation: float 4s ease-in-out infinite;
        }
        
        .pulse-animation {
            animation: pulse 2s ease-in-out infinite;
        }

        /* Electric Button (New Contact Section) */
        .btn-electric {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            transition: all 0.3s;
        }
        .btn-electric:hover { 
            box-shadow: 0 0 20px var(--primary-color); 
            transform: translateY(-2px); 
        }

        /* Social Icon Hover (New Contact Section) */
        .social-icon-btn {
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            position: relative;
            z-index: 10;
        }
        .social-icon-btn:hover {
            transform: translateY(-5px) scale(1.1);
            color: var(--primary-color);
            box-shadow: 0 10px 20px -10px var(--primary-color);
        }

        /* Tab Buttons in Settings */
        .tab-btn {
            flex: 1;
            padding: 8px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #94a3b8;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
        }
        .tab-btn:hover { color: white; }
        .tab-btn.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
            background: rgba(var(--primary-rgb), 0.1);
        }

        /* Settings Controls */
        .color-picker-wrapper {
            position: relative;
            width: 100%;
            height: 32px;
            border-radius: 6px;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .color-picker-wrapper input {
            width: 100%; height: 100%;
            border: none;
            background: transparent;
            padding: 0;
            cursor: pointer;
        }
        
        .slider-container { margin: 12px 0; }
        .slider-container input[type="range"] {
            width: 100%;
            height: 4px;
            border-radius: 2px;
            background: rgba(255,255,255,0.1);
            outline: none;
            -webkit-appearance: none;
        }
        .slider-container input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14px; height: 14px;
            border-radius: 50%;
            background: var(--primary-color);
            box-shadow: 0 0 10px var(--primary-color);
            cursor: pointer;
            transition: transform 0.2s;
            margin-top: -5px; 
        }
        .slider-container input[type="range"]::-webkit-slider-runnable-track {
            height: 4px;
            background: rgba(255,255,255,0.1);
            border-radius: 2px;
        }
        
        /* Edit overlay for icons */
        .icon-edit-overlay {
            position: absolute;
            top: -10px;
            right: -10px;
            background: red;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            cursor: pointer;
            z-index: 20;
        }
        
        .icon-edit-mode {
            border: 2px dashed var(--primary-color);
        }
    </style>
</head>
<body>
    <div id="cursor-dot"></div>
    <div id="cursor-outline"></div>
    
    <!-- FLUID CANVAS -->
    <canvas id="fluid-layer"></canvas>
    
    <div id="stars-container" class="stars"></div>
    <div id="toast-container"></div>
    <div id="particle-container"></div>
    <div id="root"></div>

    <script type="text/babel">
        // --- FLUID ENGINE CLASSES ---
        class PointerPrototype { constructor() { this.id = -1; this.texcoordX = 0; this.texcoordY = 0; this.prevTexcoordX = 0; this.prevTexcoordY = 0; this.deltaX = 0; this.deltaY = 0; this.down = false; this.moved = false; this.color = {r:0,g:0,b:0}; } }
        
        class Program {
            constructor(gl, vertexShaderSrc, fragmentShaderSrc) {
                this.gl = gl; this.uniforms = {}; this.program = this.createProgram(vertexShaderSrc, fragmentShaderSrc); this.uniforms = this.getUniforms(this.program);
            }
            bind() { this.gl.useProgram(this.program); }
            createProgram(vSrc, fSrc) {
                let gl = this.gl; let vShader = this.compileShader(gl.VERTEX_SHADER, vSrc); let fShader = this.compileShader(gl.FRAGMENT_SHADER, fSrc);
                let program = gl.createProgram(); gl.attachShader(program, vShader); gl.attachShader(program, fShader); gl.linkProgram(program); return program;
            }
            compileShader(type, source) { let gl = this.gl; let shader = gl.createShader(type); gl.shaderSource(shader, source); gl.compileShader(shader); return shader; }
            getUniforms(program) {
                let gl = this.gl; let uniforms = []; let count = gl.getProgramParameter(program, gl.ACTIVE_UNIFORMS);
                for (let i = 0; i < count; i++) { let name = gl.getActiveUniform(program, i).name; uniforms[name] = gl.getUniformLocation(program, name); } return uniforms;
            }
        }

        class Material {
            constructor(gl, vertexShader, fragmentShaderSource) { this.gl = gl; this.vertexShader = vertexShader; this.fragmentShaderSource = fragmentShaderSource; this.programs = []; this.activeProgram = null; this.uniforms = []; }
            setKeywords(keywords) {
                let hash = 0; for (let i = 0; i < keywords.length; i++) { let s = keywords[i]; for(let j=0; j<s.length; j++) hash = (hash<<5)-hash+s.charCodeAt(j)|0; }
                let program = this.programs[hash];
                if (program == null) { let kwdStr = ""; keywords.forEach(k => kwdStr += "#define " + k + "\n"); let p = new Program(this.gl, this.vertexShader, kwdStr + this.fragmentShaderSource); program = p.program; this.programs[hash] = program; }
                if (program === this.activeProgram) return; this.activeProgram = program;
                let count = this.gl.getProgramParameter(program, this.gl.ACTIVE_UNIFORMS); let uniforms = [];
                for (let i = 0; i < count; i++) { let name = this.gl.getActiveUniform(program, i).name; uniforms[name] = this.gl.getUniformLocation(program, name); } this.uniforms = uniforms;
            }
            bind() { this.gl.useProgram(this.activeProgram); }
        }

        class FluidWebGLEngine {
            constructor(canvas) {
                this.canvas = canvas; this.gl = null; this.ext = null; this.pointers = [];
                this.config = {
                    SIM_RESOLUTION: 128, DYE_RESOLUTION: 1024, DENSITY_DISSIPATION: 1,
                    VELOCITY_DISSIPATION: 0.2, PRESSURE: 0.8, PRESSURE_ITERATIONS: 20,
                    CURL: 30, SPLAT_RADIUS: 0.25, SPLAT_FORCE: 6000, SIM_SPEED: 1.0,
                    SHADING: true, PAUSED: false,
                    COLOR_A: { r: 0, g: 240/255, b: 255/255 }, COLOR_B: { r: 1, g: 0, b: 0.33 }
                };
                this.init();
            }
            updateConfig(newConfig) { Object.assign(this.config, newConfig); if(newConfig.shouldReinitFramebuffers) this.initFramebuffers(); }
            init() {
                const { gl, ext } = this.getWebGLContext(this.canvas);
                this.gl = gl; this.ext = ext;
                if (!gl) return;
                if (!ext.supportLinearFiltering) { this.config.DYE_RESOLUTION = 512; this.config.SHADING = false; }
                this.initShaders(); this.initFramebuffers(); this.initBlit();
                this.pointers.push(new PointerPrototype());
                this.bindEvents();
                this.animate();
            }
            getWebGLContext(canvas) {
                const params = { alpha: true, depth: false, stencil: false, antialias: false };
                let gl = canvas.getContext("webgl2", params);
                const isWebGL2 = !!gl;
                if (!isWebGL2) gl = canvas.getContext("webgl", params) || canvas.getContext("experimental-webgl", params);
                if (!gl) return { gl: null, ext: null };
                let halfFloat, supportLinearFiltering;
                if (isWebGL2) { gl.getExtension("EXT_color_buffer_float"); supportLinearFiltering = gl.getExtension("OES_texture_float_linear"); } 
                else { halfFloat = gl.getExtension("OES_texture_half_float"); supportLinearFiltering = gl.getExtension("OES_texture_half_float_linear"); }
                const halfFloatTexType = isWebGL2 ? gl.HALF_FLOAT : halfFloat && halfFloat.HALF_FLOAT_OES;
                let formatRGBA, formatRG, formatR;
                if (isWebGL2) {
                    formatRGBA = this.getSupportedFormat(gl, gl.RGBA16F, gl.RGBA, halfFloatTexType);
                    formatRG = this.getSupportedFormat(gl, gl.RG16F, gl.RG, halfFloatTexType);
                    formatR = this.getSupportedFormat(gl, gl.R16F, gl.RED, halfFloatTexType);
                } else {
                    formatRGBA = this.getSupportedFormat(gl, gl.RGBA, gl.RGBA, halfFloatTexType);
                    formatRG = this.getSupportedFormat(gl, gl.RGBA, gl.RGBA, halfFloatTexType);
                    formatR = this.getSupportedFormat(gl, gl.RGBA, gl.RGBA, halfFloatTexType);
                }
                return { gl, ext: { formatRGBA, formatRG, formatR, halfFloatTexType, supportLinearFiltering } };
            }
            getSupportedFormat(gl, internalFormat, format, type) { return { internalFormat, format }; }
            initShaders() {
                const gl = this.gl; const s = this.getShaderSources();
                this.material = new Material(gl, s.baseVertex, s.displayShader);
                this.material.setKeywords(this.config.SHADING ? ["SHADING"] : []);
                this.programs = {
                    copy: new Program(gl, s.baseVertex, s.copyShader),
                    clear: new Program(gl, s.baseVertex, s.clearShader),
                    splat: new Program(gl, s.baseVertex, s.splatShader),
                    advection: new Program(gl, s.baseVertex, s.advectionShader),
                    divergence: new Program(gl, s.baseVertex, s.divergenceShader),
                    curl: new Program(gl, s.baseVertex, s.curlShader),
                    vorticity: new Program(gl, s.baseVertex, s.vorticityShader),
                    pressure: new Program(gl, s.baseVertex, s.pressureShader),
                    gradientSubtract: new Program(gl, s.baseVertex, s.gradientSubtractShader),
                };
            }
            initFramebuffers() {
                const gl = this.gl; const ext = this.ext;
                let simRes = this.getResolution(this.config.SIM_RESOLUTION);
                let dyeRes = this.getResolution(this.config.DYE_RESOLUTION);
                const texType = ext.halfFloatTexType;
                const filtering = ext.supportLinearFiltering ? gl.LINEAR : gl.NEAREST;
                gl.disable(gl.BLEND);
                this.dye = this.createOrResizeDoubleFBO(this.dye, dyeRes.width, dyeRes.height, ext.formatRGBA.internalFormat, ext.formatRGBA.format, texType, filtering);
                this.velocity = this.createOrResizeDoubleFBO(this.velocity, simRes.width, simRes.height, ext.formatRG.internalFormat, ext.formatRG.format, texType, filtering);
                this.divergence = this.createFBO(simRes.width, simRes.height, ext.formatR.internalFormat, ext.formatR.format, texType, gl.NEAREST);
                this.curl = this.createFBO(simRes.width, simRes.height, ext.formatR.internalFormat, ext.formatR.format, texType, gl.NEAREST);
                this.pressure = this.createOrResizeDoubleFBO(this.pressure, simRes.width, simRes.height, ext.formatR.internalFormat, ext.formatR.format, texType, gl.NEAREST);
            }
            createOrResizeDoubleFBO(target, w, h, internalFormat, format, type, param) {
                if(!target || target.width !== w || target.height !== h) return this.createDoubleFBO(w, h, internalFormat, format, type, param);
                return target;
            }
            createFBO(w, h, internalFormat, format, type, param) {
                const gl = this.gl;
                gl.activeTexture(gl.TEXTURE0);
                let texture = gl.createTexture();
                gl.bindTexture(gl.TEXTURE_2D, texture);
                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, param);
                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, param);
                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
                gl.texImage2D(gl.TEXTURE_2D, 0, internalFormat, w, h, 0, format, type, null);
                let fbo = gl.createFramebuffer();
                gl.bindFramebuffer(gl.FRAMEBUFFER, fbo);
                gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);
                gl.viewport(0, 0, w, h);
                gl.clear(gl.COLOR_BUFFER_BIT);
                return { texture, fbo, width: w, height: h, texelSizeX: 1.0/w, texelSizeY: 1.0/h, attach(id) { gl.activeTexture(gl.TEXTURE0 + id); gl.bindTexture(gl.TEXTURE_2D, texture); return id; } };
            }
            createDoubleFBO(w, h, internalFormat, format, type, param) {
                let fbo1 = this.createFBO(w, h, internalFormat, format, type, param);
                let fbo2 = this.createFBO(w, h, internalFormat, format, type, param);
                return { width: w, height: h, texelSizeX: fbo1.texelSizeX, texelSizeY: fbo1.texelSizeY, get read() { return fbo1; }, set read(value) { fbo1 = value; }, get write() { return fbo2; }, set write(value) { fbo2 = value; }, swap() { let temp = fbo1; fbo1 = fbo2; fbo2 = temp; } };
            }
            initBlit() {
                const gl = this.gl;
                gl.bindBuffer(gl.ARRAY_BUFFER, gl.createBuffer());
                gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-1, -1, -1, 1, 1, 1, 1, -1]), gl.STATIC_DRAW);
                gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, gl.createBuffer());
                gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint16Array([0, 1, 2, 0, 2, 3]), gl.STATIC_DRAW);
                gl.vertexAttribPointer(0, 2, gl.FLOAT, false, 0, 0);
                gl.enableVertexAttribArray(0);
                this.blit = (target, clear = false) => {
                    gl.bindFramebuffer(gl.FRAMEBUFFER, target ? target.fbo : null);
                    gl.viewport(0, 0, target ? target.width : gl.drawingBufferWidth, target ? target.height : gl.drawingBufferHeight);
                    if (clear) { gl.clearColor(0.0, 0.0, 0.0, 1.0); gl.clear(gl.COLOR_BUFFER_BIT); }
                    gl.drawElements(gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0);
                };
            }
            bindEvents() {
                const mapColor = () => {
                    const cA = this.config.COLOR_A; const cB = this.config.COLOR_B;
                    let t = (Math.sin(Date.now() * 0.005) + 1) * 0.5;
                    return { r: cA.r * (1-t) + cB.r * t, g: cA.g * (1-t) + cB.g * t, b: cA.b * (1-t) + cB.b * t };
                };
                window.addEventListener("mousemove", e => {
                    let p = this.pointers[0];
                    p.moved = p.down;
                    p.prevTexcoordX = p.texcoordX; p.prevTexcoordY = p.texcoordY;
                    p.texcoordX = e.clientX / window.innerWidth;
                    p.texcoordY = 1.0 - e.clientY / window.innerHeight;
                    p.deltaX = (p.texcoordX - p.prevTexcoordX) * (this.canvas.width/this.canvas.height);
                    p.deltaY = p.texcoordY - p.prevTexcoordY;
                    p.color = mapColor();
                    if(Math.abs(p.deltaX) > 0 || Math.abs(p.deltaY) > 0) this.splatPointer(p);
                });
            }
            splatPointer(pointer) {
                let dx = pointer.deltaX * this.config.SPLAT_FORCE;
                let dy = pointer.deltaY * this.config.SPLAT_FORCE;
                this.splat(pointer.texcoordX, pointer.texcoordY, dx, dy, pointer.color);
            }
            splat(x, y, dx, dy, color) {
                const gl = this.gl;
                this.programs.splat.bind();
                gl.uniform1i(this.programs.splat.uniforms.uTarget, this.velocity.read.attach(0));
                gl.uniform1f(this.programs.splat.uniforms.aspectRatio, this.canvas.width / this.canvas.height);
                gl.uniform2f(this.programs.splat.uniforms.point, x, y);
                gl.uniform3f(this.programs.splat.uniforms.color, dx, dy, 0.0);
                gl.uniform1f(this.programs.splat.uniforms.radius, this.config.SPLAT_RADIUS / 100.0);
                this.blit(this.velocity.write); this.velocity.swap();

                gl.uniform1i(this.programs.splat.uniforms.uTarget, this.dye.read.attach(0));
                gl.uniform3f(this.programs.splat.uniforms.color, color.r, color.g, color.b);
                this.blit(this.dye.write); this.dye.swap();
            }
            animate = () => {
                if(!this.config.PAUSED && this.gl) {
                    this.step(0.016 * this.config.SIM_SPEED);
                    this.render(null);
                }
                requestAnimationFrame(this.animate);
            }
            step(dt) {
                const gl = this.gl; const p = this.programs;
                gl.disable(gl.BLEND);
                p.curl.bind(); gl.uniform2f(p.curl.uniforms.texelSize, this.velocity.texelSizeX, this.velocity.texelSizeY); gl.uniform1i(p.curl.uniforms.uVelocity, this.velocity.read.attach(0)); this.blit(this.curl);
                p.vorticity.bind(); gl.uniform2f(p.vorticity.uniforms.texelSize, this.velocity.texelSizeX, this.velocity.texelSizeY); gl.uniform1i(p.vorticity.uniforms.uVelocity, this.velocity.read.attach(0)); gl.uniform1i(p.vorticity.uniforms.uCurl, this.curl.attach(1)); gl.uniform1f(p.vorticity.uniforms.curl, this.config.CURL); gl.uniform1f(p.vorticity.uniforms.dt, dt); this.blit(this.velocity.write); this.velocity.swap();
                p.divergence.bind(); gl.uniform2f(p.divergence.uniforms.texelSize, this.velocity.texelSizeX, this.velocity.texelSizeY); gl.uniform1i(p.divergence.uniforms.uVelocity, this.velocity.read.attach(0)); this.blit(this.divergence);
                p.clear.bind(); gl.uniform1i(p.clear.uniforms.uTexture, this.pressure.read.attach(0)); gl.uniform1f(p.clear.uniforms.value, this.config.PRESSURE); this.blit(this.pressure.write); this.pressure.swap();
                p.pressure.bind(); gl.uniform2f(p.pressure.uniforms.texelSize, this.velocity.texelSizeX, this.velocity.texelSizeY); gl.uniform1i(p.pressure.uniforms.uDivergence, this.divergence.attach(0));
                for (let i = 0; i < this.config.PRESSURE_ITERATIONS; i++) { gl.uniform1i(p.pressure.uniforms.uPressure, this.pressure.read.attach(1)); this.blit(this.pressure.write); this.pressure.swap(); }
                p.gradientSubtract.bind(); gl.uniform2f(p.gradientSubtract.uniforms.texelSize, this.velocity.texelSizeX, this.velocity.texelSizeY); gl.uniform1i(p.gradientSubtract.uniforms.uPressure, this.pressure.read.attach(0)); gl.uniform1i(p.gradientSubtract.uniforms.uVelocity, this.velocity.read.attach(1)); this.blit(this.velocity.write); this.velocity.swap();
                p.advection.bind(); gl.uniform2f(p.advection.uniforms.texelSize, this.velocity.texelSizeX, this.velocity.texelSizeY); if (!this.ext.supportLinearFiltering) gl.uniform2f(p.advection.uniforms.dyeTexelSize, this.velocity.texelSizeX, this.velocity.texelSizeY);
                let velocityId = this.velocity.read.attach(0); gl.uniform1i(p.advection.uniforms.uVelocity, velocityId); gl.uniform1i(p.advection.uniforms.uSource, velocityId); gl.uniform1f(p.advection.uniforms.dt, dt); gl.uniform1f(p.advection.uniforms.dissipation, this.config.VELOCITY_DISSIPATION); this.blit(this.velocity.write); this.velocity.swap();
                if (!this.ext.supportLinearFiltering) gl.uniform2f(p.advection.uniforms.dyeTexelSize, this.dye.texelSizeX, this.dye.texelSizeY); gl.uniform1i(p.advection.uniforms.uVelocity, this.velocity.read.attach(0)); gl.uniform1i(p.advection.uniforms.uSource, this.dye.read.attach(1)); gl.uniform1f(p.advection.uniforms.dissipation, this.config.DENSITY_DISSIPATION); this.blit(this.dye.write); this.dye.swap();
            }
            render(target) {
                const gl = this.gl; gl.blendFunc(gl.ONE, gl.ONE_MINUS_SRC_ALPHA); gl.enable(gl.BLEND);
                let width = target == null ? gl.drawingBufferWidth : target.width; let height = target == null ? gl.drawingBufferHeight : target.height;
                this.material.bind(); if (this.config.SHADING) gl.uniform2f(this.material.uniforms.texelSize, 1.0 / width, 1.0 / height);
                gl.uniform1i(this.material.uniforms.uTexture, this.dye.read.attach(0)); this.blit(target);
            }
            getResolution(resolution) {
                let aspectRatio = this.gl.drawingBufferWidth / this.gl.drawingBufferHeight; if (aspectRatio < 1) aspectRatio = 1.0 / aspectRatio;
                const min = Math.round(resolution); const max = Math.round(resolution * aspectRatio);
                return this.gl.drawingBufferWidth > this.gl.drawingBufferHeight ? { width: max, height: min } : { width: min, height: max };
            }
            getShaderSources() {
                return {
                    baseVertex: `precision highp float; attribute vec2 aPosition; varying vec2 vUv; varying vec2 vL; varying vec2 vR; varying vec2 vT; varying vec2 vB; uniform vec2 texelSize; void main () { vUv = aPosition * 0.5 + 0.5; vL = vUv - vec2(texelSize.x, 0.0); vR = vUv + vec2(texelSize.x, 0.0); vT = vUv + vec2(0.0, texelSize.y); vB = vUv - vec2(0.0, texelSize.y); gl_Position = vec4(aPosition, 0.0, 1.0); }`,
                    copyShader: `precision mediump float; precision mediump sampler2D; varying highp vec2 vUv; uniform sampler2D uTexture; void main () { gl_FragColor = texture2D(uTexture, vUv); }`,
                    clearShader: `precision mediump float; precision mediump sampler2D; varying highp vec2 vUv; uniform sampler2D uTexture; uniform float value; void main () { gl_FragColor = value * texture2D(uTexture, vUv); }`,
                    displayShader: `precision highp float; precision highp sampler2D; varying vec2 vUv; varying vec2 vL; varying vec2 vR; varying vec2 vT; varying vec2 vB; uniform sampler2D uTexture; uniform vec2 texelSize; void main () { vec3 c = texture2D(uTexture, vUv).rgb; #ifdef SHADING vec3 lc = texture2D(uTexture, vL).rgb; vec3 rc = texture2D(uTexture, vR).rgb; vec3 tc = texture2D(uTexture, vT).rgb; vec3 bc = texture2D(uTexture, vB).rgb; float dx = length(rc) - length(lc); float dy = length(tc) - length(bc); vec3 n = normalize(vec3(dx, dy, length(texelSize))); vec3 l = vec3(0.0, 0.0, 1.0); float diffuse = clamp(dot(n, l) + 0.7, 0.7, 1.0); c *= diffuse; #endif float a = max(c.r, max(c.g, c.b)); gl_FragColor = vec4(c, a); }`,
                    splatShader: `precision highp float; precision highp sampler2D; varying vec2 vUv; uniform sampler2D uTarget; uniform float aspectRatio; uniform vec3 color; uniform vec2 point; uniform float radius; void main () { vec2 p = vUv - point.xy; p.x *= aspectRatio; vec3 splat = exp(-dot(p, p) / radius * 0.4) * color; vec3 base = texture2D(uTarget, vUv).xyz; gl_FragColor = vec4(base + splat, 1.0); }`,
                    advectionShader: `precision highp float; precision highp sampler2D; varying vec2 vUv; uniform sampler2D uVelocity; uniform sampler2D uSource; uniform vec2 texelSize; uniform vec2 dyeTexelSize; uniform float dt; uniform float dissipation; vec4 bilerp (sampler2D sam, vec2 uv, vec2 tsize) { vec2 st = uv / tsize - 0.5; vec2 iuv = floor(st); vec2 fuv = fract(st); vec4 a = texture2D(sam, (iuv + vec2(0.5, 0.5)) * tsize); vec4 b = texture2D(sam, (iuv + vec2(1.5, 0.5)) * tsize); vec4 c = texture2D(sam, (iuv + vec2(0.5, 1.5)) * tsize); vec4 d = texture2D(sam, (iuv + vec2(1.5, 1.5)) * tsize); return mix(mix(a, b, fuv.x), mix(c, d, fuv.x), fuv.y); } void main () { vec2 coord = vUv - dt * texture2D(uVelocity, vUv).xy * texelSize; vec4 result = texture2D(uSource, coord); float decay = 1.0 + dissipation * dt; gl_FragColor = result / decay; }`,
                    divergenceShader: `precision mediump float; precision mediump sampler2D; varying highp vec2 vUv; varying highp vec2 vL; varying highp vec2 vR; varying highp vec2 vT; varying highp vec2 vB; uniform sampler2D uVelocity; void main () { float L = texture2D(uVelocity, vL).x; float R = texture2D(uVelocity, vR).x; float T = texture2D(uVelocity, vT).y; float B = texture2D(uVelocity, vB).y; vec2 C = texture2D(uVelocity, vUv).xy; if (vL.x < 0.0) { L = -C.x; } if (vR.x > 1.0) { R = -C.x; } if (vT.y > 1.0) { T = -C.y; } if (vB.y < 0.0) { B = -C.y; } float div = 0.5 * (R - L + T - B); gl_FragColor = vec4(div, 0.0, 0.0, 1.0); }`,
                    curlShader: `precision mediump float; precision mediump sampler2D; varying highp vec2 vUv; varying highp vec2 vL; varying highp vec2 vR; varying highp vec2 vT; varying highp vec2 vB; uniform sampler2D uVelocity; void main () { float L = texture2D(uVelocity, vL).y; float R = texture2D(uVelocity, vR).y; float T = texture2D(uVelocity, vT).x; float B = texture2D(uVelocity, vB).x; float vorticity = R - L - T + B; gl_FragColor = vec4(0.5 * vorticity, 0.0, 0.0, 1.0); }`,
                    vorticityShader: `precision highp float; precision highp sampler2D; varying vec2 vUv; varying vec2 vL; varying vec2 vR; varying vec2 vT; varying vec2 vB; uniform sampler2D uVelocity; uniform sampler2D uCurl; uniform float curl; uniform float dt; void main () { float L = texture2D(uCurl, vL).x; float R = texture2D(uCurl, vR).x; float T = texture2D(uCurl, vT).x; float B = texture2D(uCurl, vB).x; float C = texture2D(uCurl, vUv).x; vec2 force = 0.5 * vec2(abs(T) - abs(B), abs(R) - abs(L)); force /= length(force) + 0.0001; force *= curl * C; force.y *= -1.0; vec2 velocity = texture2D(uVelocity, vUv).xy; velocity += force * dt; velocity = min(max(velocity, -1000.0), 1000.0); gl_FragColor = vec4(velocity, 0.0, 1.0); }`,
                    pressureShader: `precision mediump float; precision mediump sampler2D; varying highp vec2 vUv; varying highp vec2 vL; varying highp vec2 vR; varying highp vec2 vT; varying highp vec2 vB; uniform sampler2D uPressure; uniform sampler2D uDivergence; void main () { float L = texture2D(uPressure, vL).x; float R = texture2D(uPressure, vR).x; float T = texture2D(uPressure, vT).x; float B = texture2D(uPressure, vB).x; float C = texture2D(uPressure, vUv).x; float divergence = texture2D(uDivergence, vUv).x; float pressure = (L + R + B + T - divergence) * 0.25; gl_FragColor = vec4(pressure, 0.0, 0.0, 1.0); }`,
                    gradientSubtractShader: `precision mediump float; precision mediump sampler2D; varying highp vec2 vUv; varying highp vec2 vL; varying highp vec2 vR; varying highp vec2 vT; varying highp vec2 vB; uniform sampler2D uPressure; uniform sampler2D uVelocity; void main () { float L = texture2D(uPressure, vL).x; float R = texture2D(uPressure, vR).x; float T = texture2D(uPressure, vT).x; float B = texture2D(uPressure, vB).x; vec2 velocity = texture2D(uVelocity, vUv).xy; velocity.xy -= vec2(R - L, T - B); gl_FragColor = vec4(velocity, 0.0, 1.0); }`
                };
            }
        }

        const { useState, useEffect, useRef, createContext, useContext, useCallback, useMemo } = React;

        // === CONTEXT ===
        const ThemeContext = createContext();
        const AdminContext = createContext();

        // === UTILITIES ===
        const showToast = (message, type = 'success') => {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            const icon = { success: '✨', error: '❌', info: 'ℹ️', warning: '⚠️' }[type] || '✨';
            toast.innerHTML = `<span>${icon}</span><span>${message}</span>`;
            container.appendChild(toast);
            
            requestAnimationFrame(() => toast.classList.add('show'));
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 400);
            }, 3500);

            if (type === 'success' && window.confetti) {
                confetti({ particleCount: 80, spread: 70, origin: { y: 0.8 }, colors: ['#06b6d4', '#a855f7', '#10b981', '#f59e0b'] });
            }
        };

        const createClickParticles = (x, y, colors) => {
            const container = document.getElementById('particle-container');
            for (let i = 0; i < 12; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                const angle = (i / 12) * Math.PI * 2;
                const velocity = 60 + Math.random() * 40;
                const tx = Math.cos(angle) * velocity;
                const ty = Math.sin(angle) * velocity - 30;
                particle.style.cssText = `
                    left: ${x}px; top: ${y}px;
                    width: ${6 + Math.random() * 6}px; height: ${6 + Math.random() * 6}px;
                    background: ${colors[Math.floor(Math.random() * colors.length)]};
                    --tx: ${tx}px; --ty: ${ty}px;
                    animation: particleFloat 0.8s ease-out forwards;
                `;
                container.appendChild(particle);
                setTimeout(() => particle.remove(), 800);
            }
        };

        const hexToRgb = (hex) => {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? `${parseInt(result[1], 16)}, ${parseInt(result[2], 16)}, ${parseInt(result[3], 16)}` : '6, 182, 212';
        };
        
        // Helper for Fluid Engine color (0-1 range)
        const hexToRgbObj = (hex) => {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? { r: parseInt(result[1], 16)/255, g: parseInt(result[2], 16)/255, b: parseInt(result[3], 16)/255 } : { r:0,g:0,b:0 };
        };

        // === INITIAL DATA ===
        const initialData = {
            siteTitle: "Muhammad Junaid Abid - Portfolio",
            navBrand: { first: "Junaid", second: "Abid" },
            heroGreeting: "Hello, I am",
            name: "Muhammad Junaid Abid",
            role: "Project Manager / Product Manager",
            tagline: "Turning Vision into Reality",
            summary: "Agile-savvy Project & Product Manager with 6+ years of global experience driving SaaS innovation, automation, and business growth. Passionate about turning complex ideas into scalable products that deliver clarity, impact, and momentum.",
            email: "mj.abid@outlook.com",
            phone: "(+49) 163-2560561",
            location: "Munich, Germany",
            linkedin: "https://linkedin.com",
            github: "https://github.com",
            profileImage: "",
            cvUrl: "",
            cvFileName: "",
            footerText: "Built with creativity and passion ✨",
            sectionHeaders: {
                experience: "Professional Experience",
                experienceSubtitle: "A journey through innovation and impact",
                skills: "Technical Skills",
                skillsSubtitle: "Tools & technologies I work with",
                projects: "Featured Projects",
                projectsSubtitle: "Explore my portfolio of innovative projects spanning SaaS development, IoT solutions, and enterprise platforms.",
                contact: "Connect Globally",
                contactTitle: "Connect Globally",
                contactSubtitle: "Reach out from anywhere in the world",
                contactQuote: "If you need someone who can debug a circuit, manage a product roadmap, and craft a business strategy, all before lunch - let's talk."
            },
            experience: [
                { id: 1, role: "Project Manager", company: "EMIRAT AG", location: "Munich", period: "2023 - 2024", desc: "Led 4-member team, accelerating delivery by 25% via sprint optimizations. Added €150K+ revenue pipeline via client negotiations. Built first-ever Notion documentation system.", highlights: ["25% faster delivery", "€150K+ pipeline", "Notion system"] },
                { id: 2, role: "Business Development Manager", company: "NAOTILUS GmbH", location: "Munich", period: "2022 - 2023", desc: "Designed SaaS business model for EU no-code energy platforms. Secured €500K+ funding. Transformed thesis into funded product with 80% accuracy.", highlights: ["€500K+ funding", "SaaS model", "80% accuracy"] },
                { id: 3, role: "Business Analyst", company: "MBI Business Innovation", location: "Munich", period: "2019 - 2020", desc: "Launched 'InnoTalent Germany' HR platform. Optimized product-market fit through persona-driven development. Secured strategic partnerships.", highlights: ["HR platform launch", "Strategic partnerships"] },
                { id: 4, role: "Requirements Engineer", company: "Infineon Technologies", location: "Munich", period: "2018 - 2019", desc: "Managed RDDF lifecycle using Confluence & JIRA. Built workflows to accelerate publishing. Reduced documentation release time by 30%.", highlights: ["30% time reduction", "JIRA workflows"] },
                { id: 5, role: "QA/QC Engineer", company: "Advance Vision", location: "Saudi Arabia", period: "2014 - 2016", desc: "Managed 75+ workers on mega energy projects. Cut downtime by 15%. Automated workflows via Excel/Word. Delivered 100% error-free inspection logs.", highlights: ["75+ team", "15% downtime cut", "100% accuracy"] }
            ],
            projects: [
                { id: 1, title: "No-Code Digital Twin Platform", shortDesc: "SaaS platform digitizing asset management in district heat networks.", longDesc: "A comprehensive SaaS platform designed to digitize and optimize asset management in district heating networks. This EXIST-funded project leverages cutting-edge no-code technology.", company: "NAOTILUS GmbH", year: "2023", link: "", skills: ["Product Management", "Agile", "Business Development", "UX Design"], tools: ["Figma", "JIRA", "Confluence", "Python", "AWS"], images: ["https://images.unsplash.com/photo-1518770660439-4636190af475?w=600", "https://images.unsplash.com/photo-1451187580459-43490279c0fa?w=600", "https://images.unsplash.com/photo-1504384308090-c894fdcc538d?w=600"], videos: [], pdfs: [] },
                { id: 2, title: "Gamified 3D Training Platform", shortDesc: "Designed a gamified 3D training platform for enterprise employees.", longDesc: "Developed an immersive gamified 3D training platform for Siemens, reaching over 293,000 employees worldwide with a 90% satisfaction rate.", company: "Siemens AG", year: "2022", link: "", skills: ["Game Design", "3D Modeling", "Instructional Design", "Project Management"], tools: ["Unity", "Blender", "C#", "Adobe Creative Suite"], images: ["https://images.unsplash.com/photo-1614294148960-9aa740632a87?w=600", "https://images.unsplash.com/photo-1592478411213-6153e4ebc07d?w=600", "https://images.unsplash.com/photo-1593508512255-86ab42a8e620?w=600"], videos: [], pdfs: [] },
                { id: 3, title: "IoT Gas Flow Controller", shortDesc: "IoT-enabled gas flow controller powered by biogas engine.", longDesc: "An innovative IoT-enabled, battery-operated gas flow controller powered by a 2-stroke biogas engine combining hardware engineering with software development.", company: "Independent", year: "2021", link: "", skills: ["IoT Development", "Hardware Design", "Embedded Systems"], tools: ["Arduino", "Raspberry Pi", "Python", "MQTT"], images: ["https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=600", "https://images.unsplash.com/photo-1581091226825-a6a2a5aee158?w=600"], videos: [], pdfs: [] },
                { id: 4, title: "InnoTalent HR Platform", shortDesc: "Revolutionary HR platform connecting German enterprises with global talent.", longDesc: "Launched 'InnoTalent Germany', a comprehensive HR platform designed to connect German enterprises with international talent.", company: "MBI", year: "2020", link: "", skills: ["Product Strategy", "Market Research", "Partnership Development"], tools: ["Notion", "Miro", "HubSpot", "Zapier"], images: ["https://images.unsplash.com/photo-1552664730-d307ca884978?w=600", "https://images.unsplash.com/photo-1600880292203-757bb62b4baf?w=600"], videos: [], pdfs: [] }
            ],
            skills: ["JIRA", "Trello", "Asana", "Notion", "Confluence", "Figma", "Miro", "PowerBI", "Tableau", "Python", "Zapier", "ChatGPT", "Agile/Scrum", "AutoCAD"],
            socialLinks: [
                { id: 1, icon: "fa-brands fa-linkedin-in", url: "https://linkedin.com", label: "LinkedIn" },
                { id: 2, icon: "fa-brands fa-github", url: "https://github.com", label: "GitHub" },
                { id: 3, icon: "fa-brands fa-behance", url: "https://behance.net", label: "Behance" },
                { id: 4, icon: "fa-brands fa-xing", url: "https://xing.com", label: "Xing" }
            ]
        };

        const ADMIN_EMAIL = "mj.abid@outlook.com";
        const ADMIN_PASS = "@!Oh@26161";

        const presetColors = ['#06b6d4', '#a855f7', '#10b981', '#f59e0b', '#ef4444', '#ec4899', '#6366f1', '#14b8a6', '#8b5cf6', '#f97316'];

        // === ADVANCED SATURN SCENE (Asset Integration) ===
        const AdvancedSaturn = ({ theme }) => {
            const mountRef = useRef(null);
            const themeRef = useRef(theme);
            const state = useRef({ drag: false, prev: {x:0, y:0}, vel: {x:0, y:0} });
            const objs = useRef({ scene: null, renderer: null, planet: null, rGroup: null, neutronGroup: null, neptuneGroup: null, lGroup: null });

            useEffect(() => { themeRef.current = theme; }, [theme]);

            // Helper: Random Vector
            const getRandVec = () => {
                const v = new THREE.Vector3(Math.random()-0.5, Math.random()-0.5, Math.random()-0.5);
                return v.normalize();
            };

            // Helper: Create Lightning Bolt
            const createBolt = (start, end, segmentCount, offsetAmount, colHex, thick) => {
                const points = [];
                points.push(start);
                for(let i=1; i<segmentCount; i++) {
                    const t = i / segmentCount;
                    const base = new THREE.Vector3().lerpVectors(start, end, t);
                    if(base.length() < 4.0) base.normalize().multiplyScalar(4.0); 
                    const jitter = getRandVec().multiplyScalar(offsetAmount);
                    points.push(base.add(jitter));
                }
                points.push(end);
                
                const curve = new THREE.CatmullRomCurve3(points);
                const geom = new THREE.TubeGeometry(curve, 8, thick * 0.15, 3, false);
                const mat = new THREE.MeshBasicMaterial({ 
                    color: new THREE.Color(colHex), 
                    transparent: true, opacity: 1.0, 
                    side: THREE.DoubleSide, blending: THREE.AdditiveBlending, depthTest: false 
                });
                
                const mesh = new THREE.Mesh(geom, mat);
                mesh.renderOrder = 9999; mesh.frustumCulled = false;
                return mesh;
            };

            useEffect(() => {
                if(!mountRef.current || !window.THREE) return;
                const mount = mountRef.current;
                const width = mount.clientWidth;
                const height = 600; // Matches parent container

                const scene = new THREE.Scene();
                
                const camera = new THREE.PerspectiveCamera(45, width/height, 0.1, 1000);
                camera.position.z = 25;
                
                const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
                renderer.setSize(width, height);
                renderer.setPixelRatio(window.devicePixelRatio);
                renderer.toneMapping = THREE.ACESFilmicToneMapping;
                renderer.toneMappingExposure = 1.2;
                mount.appendChild(renderer.domElement);

                // Planet Setup
                const planetMat = new THREE.MeshStandardMaterial({ color: theme.pBase, emissive: theme.pGlow, emissiveIntensity: 0.8, roughness: theme.pRough, metalness: theme.pMetal });
                const planet = new THREE.Mesh(new THREE.SphereGeometry(3.5, 64, 64), planetMat);
                const pGroup = new THREE.Group(); 
                pGroup.add(planet); 
                
                const rGroup = new THREE.Group(); 
                pGroup.add(rGroup); 
                scene.add(pGroup);

                // Neutron Core Setup
                const neutronGroup = new THREE.Group();
                neutronGroup.add(new THREE.Mesh(new THREE.SphereGeometry(1.2, 32, 32), new THREE.MeshBasicMaterial({ color: 0xffffff, toneMapped: false })));
                neutronGroup.add(new THREE.Mesh(new THREE.SphereGeometry(2.0, 32, 32), new THREE.MeshBasicMaterial({ color: 0x00f0ff, transparent: true, opacity: 0.3, blending: THREE.AdditiveBlending, side: THREE.BackSide })));
                const beamGeo = new THREE.ConeGeometry(0.8, 40, 32, 1, true);
                const beamMat = new THREE.MeshBasicMaterial({ color: 0x00f0ff, transparent: true, opacity: 0.4, blending: THREE.AdditiveBlending, side: THREE.DoubleSide, depthWrite: false });
                const topBeam = new THREE.Mesh(beamGeo, beamMat); topBeam.position.y = 20; neutronGroup.add(topBeam);
                const botBeam = new THREE.Mesh(beamGeo, beamMat); botBeam.rotation.x = Math.PI; botBeam.position.y = -20; neutronGroup.add(botBeam);
                scene.add(neutronGroup);

                // Neptune Setup
                const neptuneGroup = new THREE.Group();
                neptuneGroup.add(new THREE.Mesh(new THREE.SphereGeometry(3.5, 64, 64), new THREE.MeshLambertMaterial({ color: theme.neptuneColA })));
                neptuneGroup.add(new THREE.Mesh(new THREE.SphereGeometry(3.6, 64, 64), new THREE.MeshLambertMaterial({ color: theme.neptuneColB, transparent: true, opacity: 0.4, blending: THREE.AdditiveBlending, side: THREE.DoubleSide })));
                scene.add(neptuneGroup);

                // Lightning Group
                const lGroup = new THREE.Group(); 
                scene.add(lGroup); 

                // Particles
                const createParticles = (count, size, col, spread) => {
                    const geo = new THREE.BufferGeometry();
                    const pos = new Float32Array(count * 3);
                    for(let i=0; i<count*3; i++) pos[i] = (Math.random()-0.5) * spread;
                    geo.setAttribute('position', new THREE.BufferAttribute(pos, 3));
                    return new THREE.Points(geo, new THREE.PointsMaterial({ size, color: col, transparent: true, opacity: 0.8, blending: THREE.AdditiveBlending }));
                };
                const stars = createParticles(2000, 0.1, 0xffffff, 100); scene.add(stars);
                const asteroids = createParticles(500, 0.08, 0x888888, 40); scene.add(asteroids);
                const nebula = createParticles(200, 4.0, theme.nebColor, 80); scene.add(nebula);
                const sGroup = new THREE.Group(); scene.add(sGroup);

                // Lights
                const dirLight = new THREE.DirectionalLight(0xffffff, 2.0); dirLight.position.set(10, 10, 20); scene.add(dirLight);
                const blueLight = new THREE.PointLight(0x00f0ff, 1, 50); blueLight.position.set(-10, -5, 10); scene.add(blueLight);
                scene.add(new THREE.AmbientLight(0x404040, 0.5));

                objs.current = { scene, camera, renderer, planet, rGroup, stars, asteroids, nebula, sGroup, neutronGroup, neptuneGroup, lGroup, pGroup };

                // Input Handling
                const onDown = e => { if(mount.contains(e.target)) { state.current.drag=true; state.current.prev={x:e.clientX, y:e.clientY}; } };
                const onUp = () => state.current.drag = false;
                const onMove = e => { if(state.current.drag) { state.current.vel.y += (e.clientX - state.current.prev.x) * 0.0005; state.current.vel.x += (e.clientY - state.current.prev.y) * 0.0005; state.current.prev = {x: e.clientX, y: e.clientY}; } };
                window.addEventListener('mousedown', onDown); window.addEventListener('mouseup', onUp); window.addEventListener('mousemove', onMove);

                // Animation Loop
                let animationId;
                const animate = () => {
                    animationId = requestAnimationFrame(animate);
                    const currentTheme = themeRef.current;
                    const spd = currentTheme.rotSpeed || 1;
                    
                    if(!state.current.drag) {
                        state.current.vel.x *= 0.95; state.current.vel.y *= 0.95;
                        pGroup.rotation.y += 0.002 * spd;
                    }
                    pGroup.rotation.y += state.current.vel.y; pGroup.rotation.x += state.current.vel.x;

                    // Rings
                    if(rGroup.children.length === 3) {
                        if(currentTheme.gyroPattern) {
                            rGroup.children[0].rotation.z += 0.01 * spd; rGroup.children[1].rotation.z -= 0.008 * spd; rGroup.children[2].rotation.z += 0.012 * spd;
                        } else {
                            rGroup.children.forEach((r, i) => { r.rotation.z += (i%2===0 ? 0.01 : -0.008) * spd; r.rotation.x = (Math.PI/2) + Math.sin(Date.now()*0.001 * (i+1))*0.1; });
                        }
                    }

                    stars.rotation.y -= 0.0001; asteroids.rotation.y -= 0.0005 * spd; nebula.rotation.y += 0.0002;
                    
                    if(currentTheme.neutron) { neutronGroup.rotation.y += 0.2; const s = 1 + Math.sin(Date.now()*0.05)*0.05; neutronGroup.scale.set(s,s,s); } 
                    else if (currentTheme.neptune) { neptuneGroup.children[0].rotation.y += 0.001 * spd; neptuneGroup.children[1].rotation.y -= 0.003 * spd; }

                    if(currentTheme.shoot && Math.random() < 0.02) {
                        const star = new THREE.Line(new THREE.BufferGeometry().setFromPoints([new THREE.Vector3(0,0,0), new THREE.Vector3(0,0,4)]), new THREE.LineBasicMaterial({ color: 0xffffff, transparent: true, opacity: 1 }));
                        star.position.set((Math.random()-.5)*80, (Math.random()-.5)*80, -30); star.lookAt(0,0,0); sGroup.add(star);
                    }
                    sGroup.children.forEach(c => { c.translateZ(2); c.material.opacity-=0.05; if(c.material.opacity<=0) { sGroup.remove(c); c.geometry.dispose(); c.material.dispose(); } });

                    // Lightning - Realtime update via ref
                    if(currentTheme.lightning) {
                        const cA = new THREE.Color(currentTheme.lightningColA);
                        const cB = new THREE.Color(currentTheme.lightningColB);
                        const mixColor = cA.clone().lerp(cB, Math.random());
                        
                        if(Math.random() < 0.15) {
                            const start = getRandVec().multiplyScalar(3.8);
                            const end = getRandVec().multiplyScalar(3.8);
                            if(start.distanceTo(end) < 6) lGroup.add(createBolt(start, end, 6, 0.4, mixColor, currentTheme.lightningIntensity));
                        }
                        if(Math.random() < 0.1) {
                            const center = new THREE.Vector3((Math.random()-0.5)*40, (Math.random()-0.5)*40, -10);
                            const start = center.clone().add(getRandVec().multiplyScalar(5));
                            const end = center.clone().add(getRandVec().multiplyScalar(5));
                            lGroup.add(createBolt(start, end, 5, 0.8, mixColor, currentTheme.lightningIntensity));
                        }
                    }
                    
                    for(let i = lGroup.children.length - 1; i >= 0; i--) {
                        const b = lGroup.children[i];
                        b.material.opacity -= 0.02;
                        if(b.material.opacity <= 0) { lGroup.remove(b); if(b.geometry) b.geometry.dispose(); if(b.material) b.material.dispose(); }
                    }

                    renderer.render(scene, camera);
                };
                animate();

                // Cleanup
                return () => {
                    cancelAnimationFrame(animationId);
                    window.removeEventListener('mousedown', onDown); window.removeEventListener('mouseup', onUp); window.removeEventListener('mousemove', onMove);
                    if(mount.contains(renderer.domElement)) mount.removeChild(renderer.domElement);
                    renderer.dispose();
                };
            }, []); // Init only once

            // Update materials on theme change
            useEffect(() => {
                const { planet, rGroup, stars, asteroids, nebula, sGroup, neutronGroup, neptuneGroup, lGroup } = objs.current;
                if(!planet) return;

                planet.material.color.set(theme.pBase); planet.material.emissive.set(theme.pGlow); planet.material.roughness = theme.pRough; planet.material.metalness = theme.pMetal;
                if(neptuneGroup) { neptuneGroup.children[0].material.color.set(theme.neptuneColA); neptuneGroup.children[1].material.color.set(theme.neptuneColB); }

                stars.visible = theme.stars; asteroids.visible = theme.ast; nebula.visible = theme.nebula; nebula.material.color.set(theme.nebColor); sGroup.visible = theme.shoot;
                
                if(theme.neutron) { planet.visible = false; neutronGroup.visible = true; neptuneGroup.visible = false; } 
                else if (theme.neptune) { planet.visible = false; neutronGroup.visible = false; neptuneGroup.visible = true; } 
                else { planet.visible = true; neutronGroup.visible = false; neptuneGroup.visible = false; }

                // Clear lightning immediately if turned off
                if(!theme.lightning) { while(lGroup.children.length) { const c = lGroup.children[0]; lGroup.remove(c); if(c.geometry) c.geometry.dispose(); if(c.material) c.material.dispose(); } }

                while(rGroup.children.length) { const m = rGroup.children[0]; m.geometry.dispose(); m.material.dispose(); rGroup.remove(m); }
                const mkRing = (r, t, c) => {
                    const m = new THREE.Mesh(new THREE.TorusGeometry(r, theme.rThick, 4, 120), new THREE.MeshStandardMaterial({ color: c, emissive: c, emissiveIntensity: 0.5, roughness: theme.rRough, metalness: theme.rMetal, transparent: true, opacity: 0.9, side: THREE.DoubleSide }));
                    m.rotation.x = t; rGroup.add(m);
                };
                if (theme.gyroPattern) { mkRing(5.0, Math.PI/2.1, theme.r1Col); mkRing(6.5, Math.PI/6, theme.r2Col); mkRing(8.0, -Math.PI/4, theme.r3Col); } 
                else { mkRing(5.0, Math.PI/2, theme.r1Col); mkRing(6.5, Math.PI/2, theme.r2Col); mkRing(8.0, Math.PI/2, theme.r3Col); }

            }, [theme]);

            return <div ref={mountRef} className="w-full h-[600px] cursor-move" title="Drag to rotate planet" />;
        };

        // === FLUID LAYER COMPONENT ===
        const FluidLayer = ({ theme }) => {
            const engineRef = useRef(null);
            
            useEffect(() => {
                const canvas = document.getElementById('fluid-layer');
                if(!canvas) return;
                const resize = () => { 
                    canvas.width = window.innerWidth; 
                    canvas.height = window.innerHeight; 
                    if(engineRef.current) engineRef.current.initFramebuffers(); 
                };
                window.addEventListener('resize', resize); resize();
                try { engineRef.current = new FluidWebGLEngine(canvas); } catch(e) { console.error("WebGL init failed", e); }
                return () => window.removeEventListener('resize', resize);
            }, []);

            useEffect(() => {
                if(engineRef.current) {
                    document.getElementById('fluid-layer').style.display = theme.fluidEnabled ? 'block' : 'none';
                    engineRef.current.updateConfig({
                        SIM_RESOLUTION: theme.fluidRes, 
                        DENSITY_DISSIPATION: 4.0 - (theme.fluidDissipation * 0.03), 
                        SPLAT_FORCE: theme.fluidForce,
                        SPLAT_RADIUS: theme.fluidRadius / 1000.0, 
                        SIM_SPEED: theme.fluidSpeed,
                        COLOR_A: hexToRgbObj(theme.fluidColorA), 
                        COLOR_B: hexToRgbObj(theme.fluidColorB),
                    });
                }
            }, [theme]);

            return null;
        };

        // === STAR FIELD ===
        const StarField = ({ theme }) => {
            useEffect(() => {
                const container = document.getElementById('stars-container');
                container.innerHTML = '';
                
                for (let i = 0; i < 180; i++) {
                    const star = document.createElement('div');
                    star.className = 'star';
                    star.style.cssText = `
                        left: ${Math.random() * 100}%; 
                        top: ${Math.random() * 100}%;
                        width: ${Math.random() * 2.5 + 0.5}px;
                        animation-delay: ${Math.random() * 3}s;
                    `;
                    star.style.height = star.style.width;
                    container.appendChild(star);
                }

                if (!theme.spaceEffects) return;

                const createShootingStar = () => {
                    const star = document.createElement('div');
                    star.className = 'shooting-star';
                    star.style.cssText = `
                        left: ${Math.random() * 100}%;
                        top: ${Math.random() * 40}%;
                        width: ${Math.random() * 150 + 80}px;
                    `;
                    document.body.appendChild(star);
                    setTimeout(() => star.remove(), 1000);
                };

                const interval = setInterval(createShootingStar, 4000 / theme.animationSpeed);
                return () => clearInterval(interval);
            }, [theme.spaceEffects, theme.animationSpeed]);
            
            return null;
        };

        // === NEBULA ===
        const NebulaBackground = ({ theme }) => {
            if (!theme.spaceEffects) return null;
            return (
                <>
                    <div className="nebula" style={{ top: '5%', left: '15%', width: '600px', height: '600px', background: `radial-gradient(circle, ${theme.primaryColor}50, transparent 70%)` }} />
                    <div className="nebula" style={{ bottom: '10%', right: '5%', width: '500px', height: '500px', background: `radial-gradient(circle, ${theme.secondaryColor}40, transparent 70%)` }} />
                    <div className="nebula" style={{ top: '50%', left: '50%', width: '800px', height: '800px', transform: 'translate(-50%, -50%)', background: `radial-gradient(circle, ${theme.accentColor || '#10b981'}20, transparent 70%)` }} />
                </>
            );
        };

        // === VIDEO HOVER PLAYER ===
        const VideoHoverPlayer = ({ src, className, isAdmin, onRemove }) => {
            const videoRef = useRef(null);
            const [isPlaying, setIsPlaying] = useState(false);

            const isEmbed = src?.includes('youtube') || src?.includes('vimeo');

            const handleMouseEnter = () => {
                if (videoRef.current && !isEmbed) {
                    videoRef.current.play().catch(() => {});
                    setIsPlaying(true);
                }
            };

            const handleMouseLeave = () => {
                if (videoRef.current && !isEmbed) {
                    videoRef.current.pause();
                    videoRef.current.currentTime = 0;
                    setIsPlaying(false);
                }
            };

            return (
                <div 
                    className={`video-container ${isAdmin ? 'media-editable' : ''} ${className}`}
                    onMouseEnter={handleMouseEnter}
                    onMouseLeave={handleMouseLeave}
                >
                    {isEmbed ? (
                        <iframe src={src} className="w-full h-full rounded-lg" allowFullScreen allow="autoplay" />
                    ) : (
                        <>
                            <video ref={videoRef} src={src} className="w-full h-full object-cover rounded-lg" muted loop playsInline />
                            {!isPlaying && (
                                <div className="video-play-icon">
                                    <span>▶</span>
                                </div>
                            )}
                        </>
                    )}
                    {isAdmin && (
                        <div className="media-overlay">
                            <button className="media-btn bg-red-600 text-white" onClick={onRemove}>🗑️</button>
                        </div>
                    )}
                </div>
            );
        };

        // === MODALS ===
        const MediaManagerModal = ({ isOpen, onClose, projectId, mediaType, data, setData, theme }) => {
            const [urlInput, setUrlInput] = useState('');
            const [dragOver, setDragOver] = useState(false);
            const fileInputRef = useRef(null);

            if (!isOpen) return null;
            const project = data.projects.find(p => p.id === projectId);
            if (!project) return null;

            const mediaArray = project[mediaType] || [];

            const handleFileUpload = (files) => {
                Array.from(files).forEach(file => {
                    const reader = new FileReader();
                    reader.onload = (e) => addMedia(e.target.result, file.name);
                    if ((mediaType === 'images' && file.type.startsWith('image/')) ||
                        (mediaType === 'videos' && file.type.startsWith('video/')) ||
                        (mediaType === 'pdfs' && file.type === 'application/pdf')) {
                        reader.readAsDataURL(file);
                    }
                });
            };

            const addMedia = (url, fileName = '') => {
                if (!url?.trim()) return;
                const newData = { ...data };
                const idx = newData.projects.findIndex(p => p.id === projectId);
                if (mediaType === 'pdfs') {
                    newData.projects[idx].pdfs = [...(newData.projects[idx].pdfs || []), { url, name: fileName || 'Document.pdf' }];
                } else {
                    newData.projects[idx][mediaType] = [...(newData.projects[idx][mediaType] || []), url];
                }
                setData(newData);
                localStorage.setItem('portfolioData', JSON.stringify(newData));
                setUrlInput('');
                showToast(`${mediaType.slice(0, -1)} added! 🎉`);
            };

            const removeMedia = (index) => {
                const newData = { ...data };
                const idx = newData.projects.findIndex(p => p.id === projectId);
                newData.projects[idx][mediaType] = newData.projects[idx][mediaType].filter((_, i) => i !== index);
                setData(newData);
                localStorage.setItem('portfolioData', JSON.stringify(newData));
                showToast('Removed!', 'info');
            };

            const icons = { images: '🖼️', videos: '🎬', pdfs: '📄' };
            const accepts = { images: 'image/*', videos: 'video/*', pdfs: '.pdf' };

            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal-content glass-strong p-8" onClick={e => e.stopPropagation()}>
                        <div className="flex justify-between items-center mb-8">
                            <h2 className="text-2xl font-bold text-gradient">
                                {icons[mediaType]} Manage {mediaType.charAt(0).toUpperCase() + mediaType.slice(1)}
                            </h2>
                            <button onClick={onClose} className="text-slate-400 hover:text-white text-3xl transition-all hover:rotate-90">×</button>
                        </div>

                        <div 
                            className={`upload-zone mb-8 ${dragOver ? 'dragover' : ''}`}
                            onDragOver={(e) => { e.preventDefault(); setDragOver(true); }}
                            onDragLeave={() => setDragOver(false)}
                            onDrop={(e) => { e.preventDefault(); setDragOver(false); handleFileUpload(e.dataTransfer.files); }}
                            onClick={() => fileInputRef.current?.click()}
                        >
                            <input ref={fileInputRef} type="file" multiple accept={accepts[mediaType]} className="hidden" onChange={(e) => handleFileUpload(e.target.files)} />
                            <div className="text-6xl mb-4">{icons[mediaType]}</div>
                            <p className="text-slate-300 font-semibold text-lg">Drag & drop {mediaType} here</p>
                            <p className="text-slate-500 text-sm mt-2">or click to browse</p>
                        </div>

                        <div className="flex gap-3 mb-8">
                            <input type="text" placeholder={`Enter ${mediaType} URL...`} value={urlInput} onChange={(e) => setUrlInput(e.target.value)}
                                className="flex-1 bg-slate-800/80 border-2 border-slate-600 rounded-xl p-4 text-white outline-none focus:border-cyan-400 transition-colors" />
                            <button onClick={() => addMedia(urlInput)} className="px-8 py-4 rounded-xl font-bold transition-all hover:scale-105 shadow-glow" style={{ background: `linear-gradient(135deg, ${theme.primaryColor}, ${theme.secondaryColor})` }}>
                                Add
                            </button>
                        </div>

                        <div className="media-grid">
                            {mediaArray.map((item, index) => (
                                <div key={index} className="media-item group">
                                    {mediaType === 'images' && <img src={item} alt="" />}
                                    {mediaType === 'videos' && (item.includes('youtube') || item.includes('vimeo') ? <iframe src={item} className="w-full h-full" /> : <video src={item} />)}
                                    {mediaType === 'pdfs' && (
                                        <div className="w-full h-full bg-slate-700 flex flex-col items-center justify-center">
                                            <span className="text-4xl">📄</span>
                                            <span className="text-xs text-slate-300 mt-2 px-2 truncate w-full text-center">{item.name || 'PDF'}</span>
                                        </div>
                                    )}
                                    <div className="media-overlay">
                                        <button className="media-btn bg-red-600 text-white" onClick={() => removeMedia(index)}>🗑️</button>
                                    </div>
                                </div>
                            ))}
                        </div>
                        {mediaArray.length === 0 && <p className="text-center text-slate-500 py-10">No {mediaType} yet. Add some above!</p>}
                    </div>
                </div>
            );
        };

        const ProfileImageModal = ({ isOpen, onClose, data, setData, theme }) => {
            const [urlInput, setUrlInput] = useState(data.profileImage || '');
            const fileInputRef = useRef(null);

            if (!isOpen) return null;

            const updateImage = (url) => {
                const newData = { ...data, profileImage: url };
                setData(newData);
                localStorage.setItem('portfolioData', JSON.stringify(newData));
                showToast('Profile updated! 📸');
            };

            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal-content glass-strong p-8 max-w-md" onClick={e => e.stopPropagation()}>
                        <h2 className="text-2xl font-bold text-center mb-6 text-gradient">📷 Profile Image</h2>
                        
                        <div className="flex justify-center mb-6">
                            <div className="w-40 h-40 rounded-full overflow-hidden ring-4" style={{ ringColor: theme.primaryColor }}>
                                <img src={data.profileImage || `https://ui-avatars.com/api/?name=${data.name?.replace(' ', '+') || 'User'}&background=0f172a&color=06b6d4&size=400`} alt="" className="w-full h-full object-cover" />
                            </div>
                        </div>

                        <div className="upload-zone mb-4 py-8" onClick={() => fileInputRef.current?.click()}>
                            <input ref={fileInputRef} type="file" accept="image/*" className="hidden" onChange={(e) => {
                                if (e.target.files[0]) {
                                    const reader = new FileReader();
                                    reader.onload = (ev) => updateImage(ev.target.result);
                                    reader.readAsDataURL(e.target.files[0]);
                                }
                            }} />
                            <div className="text-4xl mb-2">📁</div>
                            <p className="text-slate-400 text-sm">Click to upload</p>
                        </div>

                        <div className="flex gap-2 mb-4">
                            <input type="text" placeholder="Or paste image URL..." value={urlInput} onChange={(e) => setUrlInput(e.target.value)}
                                className="flex-1 bg-slate-800 border border-slate-600 rounded-lg p-3 text-white text-sm outline-none" />
                            <button onClick={() => updateImage(urlInput)} className="px-4 rounded-lg font-bold" style={{ background: theme.primaryColor }}>Set</button>
                        </div>

                        <div className="grid grid-cols-2 gap-2">
                            <button onClick={() => { updateImage(''); setUrlInput(''); }} className="py-3 rounded-lg font-bold bg-red-600/20 text-red-400 hover:bg-red-600/30">Remove</button>
                            <button onClick={onClose} className="py-3 rounded-lg font-bold bg-slate-700 hover:bg-slate-600">Done</button>
                        </div>
                    </div>
                </div>
            );
        };

        const CVModal = ({ isOpen, onClose, data, setData, theme }) => {
            const fileInputRef = useRef(null);
            if (!isOpen) return null;

            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal-content glass-strong p-8 max-w-md" onClick={e => e.stopPropagation()}>
                        <h2 className="text-2xl font-bold text-center mb-6 text-gradient">📄 Upload CV</h2>
                        
                        {data.cvFileName && (
                            <div className="mb-4 p-4 bg-slate-800 rounded-xl flex items-center gap-4">
                                <span className="text-4xl">📎</span>
                                <div className="flex-1">
                                    <p className="font-semibold">{data.cvFileName}</p>
                                    <p className="text-slate-400 text-sm">Current CV</p>
                                </div>
                            </div>
                        )}

                        <div className="upload-zone" onClick={() => fileInputRef.current?.click()}>
                            <input ref={fileInputRef} type="file" accept=".pdf,.doc,.docx" className="hidden" onChange={(e) => {
                                if (e.target.files[0]) {
                                    const file = e.target.files[0];
                                    const reader = new FileReader();
                                    reader.onload = (ev) => {
                                        const newData = { ...data, cvUrl: ev.target.result, cvFileName: file.name };
                                        setData(newData);
                                        localStorage.setItem('portfolioData', JSON.stringify(newData));
                                        showToast('CV uploaded! 📄');
                                    };
                                    reader.readAsDataURL(file);
                                }
                            }} />
                            <div className="text-5xl mb-3">📤</div>
                            <p className="text-slate-300 font-semibold">Click to upload CV</p>
                            <p className="text-slate-500 text-sm mt-1">PDF, DOC, DOCX</p>
                        </div>

                        <button onClick={onClose} className="w-full py-3 mt-6 rounded-xl font-bold bg-slate-700 hover:bg-slate-600 transition-colors">Done</button>
                    </div>
                </div>
            );
        };

        const EditModal = ({ editModal, setEditModal, data, setData, theme }) => {
            if (!editModal.open) return null;

            const save = () => {
                let newData = { ...data };
                if (editModal.path) {
                    const keys = editModal.path.split('.');
                    let obj = newData;
                    for (let i = 0; i < keys.length - 1; i++) {
                        obj = obj[keys[i]];
                    }
                    obj[keys[keys.length - 1]] = editModal.isArray ? editModal.value.split(',').map(s => s.trim()).filter(Boolean) : editModal.value;
                } else if (editModal.field) {
                    newData[editModal.field] = editModal.value;
                }
                setData(newData);
                localStorage.setItem('portfolioData', JSON.stringify(newData));
                setEditModal({ open: false });
                showToast('Saved! ✨');
            };

            return (
                <div className="modal-overlay" onClick={() => setEditModal({ open: false })}>
                    <div className="glass-strong p-8 rounded-3xl w-full max-w-lg" onClick={e => e.stopPropagation()}>
                        <h2 className="text-xl font-bold mb-6 text-gradient">{editModal.label || 'Edit Content'}</h2>
                        {editModal.type === 'textarea' ? (
                            <textarea rows="6" className="w-full bg-slate-800 border-2 border-slate-600 rounded-xl p-4 text-white outline-none focus:border-cyan-400 resize-none mb-6" value={editModal.value} onChange={(e) => setEditModal({...editModal, value: e.target.value})} />
                        ) : (
                            <input type="text" className="w-full bg-slate-800 border-2 border-slate-600 rounded-xl p-4 text-white outline-none focus:border-cyan-400 mb-6" value={editModal.value} onChange={(e) => setEditModal({...editModal, value: e.target.value})} />
                        )}
                        <div className="flex gap-4">
                            <button onClick={() => setEditModal({ open: false })} className="flex-1 py-3 bg-slate-700 rounded-xl font-bold hover:bg-slate-600">Cancel</button>
                            <button onClick={save} className="flex-1 py-3 rounded-xl font-bold hover:scale-105 transition-transform" style={{ background: `linear-gradient(135deg, ${theme.primaryColor}, ${theme.secondaryColor})` }}>Save</button>
                        </div>
                    </div>
                </div>
            );
        };

        const SocialLinkModal = ({ isOpen, onClose, data, setData, theme, editingLink }) => {
            const [form, setForm] = useState({ label: '', url: '', icon: 'fa-brands fa-github' });
            
            useEffect(() => {
                if (editingLink) {
                    setForm({ ...editingLink });
                } else {
                    setForm({ label: '', url: '', icon: 'fa-brands fa-github' });
                }
            }, [editingLink]);

            if (!isOpen) return null;

            const handleSave = () => {
                if (!form.url || !form.icon) return showToast('Fill all fields!', 'error');
                
                let newLinks = [...(data.socialLinks || [])];
                if (editingLink) {
                    newLinks = newLinks.map(l => l.id === editingLink.id ? { ...l, ...form } : l);
                } else {
                    newLinks.push({ id: Date.now(), ...form });
                }
                
                const newData = { ...data, socialLinks: newLinks };
                setData(newData);
                localStorage.setItem('portfolioData', JSON.stringify(newData));
                showToast('Saved! 💾');
                onClose();
            };

            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="glass-strong p-8 rounded-3xl w-full max-w-md" onClick={e => e.stopPropagation()}>
                        <h2 className="text-xl font-bold mb-6 text-gradient">{editingLink ? 'Edit' : 'Add'} Social Link</h2>
                        <div className="space-y-4">
                            <div>
                                <label className="text-xs text-slate-400 mb-1 block">Platform Name</label>
                                <input placeholder="e.g. LinkedIn" className="w-full bg-slate-800 border border-slate-600 rounded-xl p-3 text-white outline-none" value={form.label} onChange={e => setForm({...form, label: e.target.value})} />
                            </div>
                            <div>
                                <label className="text-xs text-slate-400 mb-1 block">URL</label>
                                <input placeholder="https://..." className="w-full bg-slate-800 border border-slate-600 rounded-xl p-3 text-white outline-none" value={form.url} onChange={e => setForm({...form, url: e.target.value})} />
                            </div>
                            <div>
                                <label className="text-xs text-slate-400 mb-1 block">FontAwesome Class</label>
                                <div className="flex gap-2">
                                    <input placeholder="fa-brands fa-github" className="flex-1 bg-slate-800 border border-slate-600 rounded-xl p-3 text-white outline-none" value={form.icon} onChange={e => setForm({...form, icon: e.target.value})} />
                                    <div className="w-12 flex items-center justify-center bg-slate-700 rounded-xl text-xl"><i className={form.icon}></i></div>
                                </div>
                                <p className="text-[10px] text-slate-500 mt-1">Use 'fa-brands fa-...' for brands, 'fa-solid fa-...' for icons.</p>
                            </div>
                        </div>
                        <div className="flex gap-4 mt-6">
                            <button onClick={onClose} className="flex-1 py-3 bg-slate-700 rounded-xl font-bold">Cancel</button>
                            <button onClick={handleSave} className="flex-1 py-3 rounded-xl font-bold" style={{ background: `linear-gradient(135deg, ${theme.primaryColor}, ${theme.secondaryColor})` }}>Save</button>
                        </div>
                    </div>
                </div>
            );
        };

        const AddItemModal = ({ type, isOpen, onClose, data, setData, theme }) => {
            const [form, setForm] = useState({});
            if (!isOpen) return null;

            const fields = {
                experience: [
                    { key: 'role', label: 'Role *', required: true },
                    { key: 'company', label: 'Company *', required: true },
                    { key: 'location', label: 'Location' },
                    { key: 'period', label: 'Period' },
                    { key: 'desc', label: 'Description', type: 'textarea' }
                ],
                project: [
                    { key: 'title', label: 'Title *', required: true },
                    { key: 'shortDesc', label: 'Short Description *', required: true },
                    { key: 'longDesc', label: 'Full Description', type: 'textarea' },
                    { key: 'company', label: 'Company' },
                    { key: 'year', label: 'Year' },
                    { key: 'skills', label: 'Skills (comma-separated)' },
                    { key: 'tools', label: 'Tools (comma-separated)' }
                ]
            };

            const handleAdd = () => {
                if (type === 'experience') {
                    if (!form.role || !form.company) return showToast('Fill required fields!', 'error');
                    const newItem = { id: Date.now(), ...form, highlights: [] };
                    const newData = { ...data, experience: [...data.experience, newItem] };
                    setData(newData);
                    localStorage.setItem('portfolioData', JSON.stringify(newData));
                } else if (type === 'project') {
                    if (!form.title || !form.shortDesc) return showToast('Fill required fields!', 'error');
                    const newItem = {
                        id: Date.now(),
                        ...form,
                        skills: (form.skills || '').split(',').map(s => s.trim()).filter(Boolean),
                        tools: (form.tools || '').split(',').map(s => s.trim()).filter(Boolean),
                        images: [], videos: [], pdfs: []
                    };
                    const newData = { ...data, projects: [...data.projects, newItem] };
                    setData(newData);
                    localStorage.setItem('portfolioData', JSON.stringify(newData));
                }
                showToast(`${type} added! 🎉`);
                onClose();
                setForm({});
            };

            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="glass-strong p-8 rounded-3xl w-full max-w-lg max-h-[85vh] overflow-y-auto" onClick={e => e.stopPropagation()}>
                        <h2 className="text-xl font-bold mb-6 text-gradient">➕ Add {type === 'experience' ? 'Experience' : 'Project'}</h2>
                        <div className="space-y-4">
                            {fields[type].map(f => f.type === 'textarea' ? (
                                <textarea key={f.key} placeholder={f.label} rows="3" className="w-full bg-slate-800 border border-slate-600 rounded-xl p-3 text-white outline-none resize-none" value={form[f.key] || ''} onChange={e => setForm({...form, [f.key]: e.target.value})} />
                            ) : (
                                <input key={f.key} placeholder={f.label} className="w-full bg-slate-800 border border-slate-600 rounded-xl p-3 text-white outline-none" value={form[f.key] || ''} onChange={e => setForm({...form, [f.key]: e.target.value})} />
                            ))}
                        </div>
                        <div className="flex gap-4 mt-6">
                            <button onClick={onClose} className="flex-1 py-3 bg-slate-700 rounded-xl font-bold">Cancel</button>
                            <button onClick={handleAdd} className="flex-1 py-3 rounded-xl font-bold" style={{ background: `linear-gradient(135deg, ${theme.primaryColor}, ${theme.secondaryColor})` }}>Add</button>
                        </div>
                    </div>
                </div>
            );
        };

        // === PROJECT CARD ===
        const ProjectCard = ({ project, onClick, isAdmin, theme, onManageImages, onDelete }) => (
            <div className={`glass rounded-3xl overflow-hidden group transition-all duration-500 hover:shadow-glow-hover hover:-translate-y-2 ${isAdmin ? 'relative' : ''}`} data-aos="fade-up">
                {isAdmin && <button className="delete-btn opacity-100" onClick={(e) => { e.stopPropagation(); onDelete(); }}>×</button>}
                
                <div className="image-gallery p-4 bg-slate-800/40">
                    {project.images?.slice(0, 3).map((img, idx) => (
                        <div key={idx} className={isAdmin ? 'media-editable' : ''}>
                            <img src={img} alt="" className="rounded-xl" />
                            {isAdmin && (
                                <div className="media-overlay rounded-xl">
                                    <button className="media-btn bg-blue-600 text-white text-sm" onClick={(e) => { e.stopPropagation(); onManageImages(); }}>✏️</button>
                                </div>
                            )}
                        </div>
                    ))}
                    {(!project.images || project.images.length === 0) && (
                        <div className="col-span-3 h-28 flex items-center justify-center text-slate-500">
                            {isAdmin ? <button onClick={(e) => { e.stopPropagation(); onManageImages(); }} className="hover:text-cyan-400 transition-colors">+ Add Images</button> : 'No images'}
                        </div>
                    )}
                </div>

                <div className="p-6" onClick={onClick}>
                    <div className="flex justify-between items-start mb-3">
                        <h3 className="text-xl font-bold text-white group-hover:text-gradient transition-all">{project.title}</h3>
                        <span className="text-xs px-3 py-1 rounded-full bg-slate-800 text-slate-400">{project.year}</span>
                    </div>
                    <p className="text-sm font-medium mb-3" style={{ color: theme.primaryColor }}>{project.company}</p>
                    <p className="text-slate-400 text-sm mb-5 line-clamp-2">{project.shortDesc}</p>
                    
                    <div className="flex flex-wrap gap-2 mb-4">
                        {project.skills?.slice(0, 2).map(s => <span key={s} className="skill-tag text-xs px-3 py-1 rounded-full">{s}</span>)}
                        {project.tools?.slice(0, 2).map(t => <span key={t} className="tool-tag text-xs px-3 py-1 rounded-full">{t}</span>)}
                    </div>
                    
                    <button className="w-full py-3 rounded-xl font-semibold text-sm transition-all hover:scale-[1.02]" style={{ background: `linear-gradient(135deg, ${theme.primaryColor}30, ${theme.secondaryColor}20)`, color: theme.primaryColor, border: `1px solid ${theme.primaryColor}40` }}>
                        View Details →
                    </button>
                </div>
            </div>
        );

        // === PROJECT MODAL ===
        const ProjectModal = ({ project, onClose, isAdmin, theme, data, setData, openEdit }) => {
            const [mediaManager, setMediaManager] = useState({ open: false, type: null });
            if (!project) return null;
            
            const p = data.projects.find(x => x.id === project.id) || project;
            const idx = data.projects.findIndex(x => x.id === project.id);

            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal-content glass-strong" onClick={e => e.stopPropagation()}>
                        <div className="p-8">
                            <div className="flex justify-between items-start mb-8">
                                <div>
                                    <h2 className={`text-3xl font-bold text-white mb-2 ${isAdmin ? 'editable-highlight' : ''}`} onClick={() => isAdmin && openEdit(`projects.${idx}.title`, p.title, 'text', 'Project Title')}>
                                        {p.title}
                                    </h2>
                                    <div className="flex gap-4 text-sm">
                                        <span className={isAdmin ? 'editable-highlight' : ''} style={{ color: theme.primaryColor }} onClick={() => isAdmin && openEdit(`projects.${idx}.company`, p.company, 'text', 'Company')}>{p.company}</span>
                                        <span className={`text-slate-400 ${isAdmin ? 'editable-highlight' : ''}`} onClick={() => isAdmin && openEdit(`projects.${idx}.year`, p.year, 'text', 'Year')}>{p.year}</span>
                                    </div>
                                </div>
                                <button onClick={onClose} className="text-slate-400 hover:text-white text-3xl transition-all hover:rotate-90">×</button>
                            </div>

                            {/* Images */}
                            <div className="mb-8">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-lg font-bold">📸 Images</h3>
                                    {isAdmin && <button onClick={() => setMediaManager({ open: true, type: 'images' })} className="text-sm px-4 py-2 rounded-lg bg-slate-800 hover:bg-slate-700" style={{ color: theme.primaryColor }}>Manage</button>}
                                </div>
                                {p.images?.length > 0 ? (
                                    <div className="image-gallery">{p.images.map((img, i) => <img key={i} src={img} alt="" />)}</div>
                                ) : <p className="text-slate-500 text-center py-6">No images</p>}
                            </div>

                            {/* Videos */}
                            <div className="mb-8">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-lg font-bold">🎬 Videos <span className="text-sm font-normal text-slate-400">(hover to play)</span></h3>
                                    {isAdmin && <button onClick={() => setMediaManager({ open: true, type: 'videos' })} className="text-sm px-4 py-2 rounded-lg bg-slate-800 hover:bg-slate-700" style={{ color: theme.primaryColor }}>Manage</button>}
                                </div>
                                {p.videos?.length > 0 ? (
                                    <div className="space-y-4">{p.videos.map((v, i) => <VideoHoverPlayer key={i} src={v} className="aspect-video" isAdmin={false} />)}</div>
                                ) : <p className="text-slate-500 text-center py-6">No videos yet</p>}
                            </div>

                            {/* Description */}
                            <div className="mb-8">
                                <h3 className="text-lg font-bold mb-3">📝 Description</h3>
                                <p className={`text-slate-300 leading-relaxed ${isAdmin ? 'editable-highlight' : ''}`} onClick={() => isAdmin && openEdit(`projects.${idx}.longDesc`, p.longDesc, 'textarea', 'Description')}>
                                    {p.longDesc}
                                </p>
                            </div>

                            {/* Skills & Tools */}
                            <div className="grid md:grid-cols-2 gap-8 mb-8">
                                <div>
                                    <h3 className="text-lg font-bold mb-4">🎯 Skills</h3>
                                    <div className={`flex flex-wrap gap-2 ${isAdmin ? 'editable-highlight' : ''}`} onClick={() => isAdmin && openEdit(`projects.${idx}.skills`, p.skills?.join(', '), 'text', 'Skills', true)}>
                                        {p.skills?.map(s => <span key={s} className="skill-tag px-4 py-2 rounded-full text-sm">{s}</span>)}
                                    </div>
                                </div>
                                <div>
                                    <h3 className="text-lg font-bold mb-4">🛠️ Tools</h3>
                                    <div className={`flex flex-wrap gap-2 ${isAdmin ? 'editable-highlight' : ''}`} onClick={() => isAdmin && openEdit(`projects.${idx}.tools`, p.tools?.join(', '), 'text', 'Tools', true)}>
                                        {p.tools?.map(t => <span key={t} className="tool-tag px-4 py-2 rounded-full text-sm">{t}</span>)}
                                    </div>
                                </div>
                            </div>

                            {/* PDFs */}
                            <div>
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-lg font-bold">📄 Documents</h3>
                                    {isAdmin && <button onClick={() => setMediaManager({ open: true, type: 'pdfs' })} className="text-sm px-4 py-2 rounded-lg bg-slate-800 hover:bg-slate-700" style={{ color: theme.primaryColor }}>Manage</button>}
                                </div>
                                {p.pdfs?.length > 0 ? (
                                    <div className="flex flex-wrap gap-3">
                                        {p.pdfs.map((pdf, i) => <a key={i} href={pdf.url || pdf} download className="flex items-center gap-2 px-5 py-3 rounded-xl bg-slate-800 hover:bg-slate-700 transition-colors">📄 {pdf.name || 'Document'}</a>)}
                                    </div>
                                ) : <p className="text-slate-500">No documents</p>}
                            </div>
                        </div>
                    </div>
                    {mediaManager.open && <MediaManagerModal isOpen onClose={() => setMediaManager({ open: false })} projectId={p.id} mediaType={mediaManager.type} data={data} setData={setData} theme={theme} />}
                </div>
            );
        };

        // === SETTINGS PANEL ===
        const SettingsPanel = ({ isOpen, theme, setTheme }) => {
            const [tab, setTab] = useState('MAIN');
            if (!isOpen) return null;

            const updateColor = (color, type) => {
                const newTheme = { ...theme, [type]: color };
                setTheme(newTheme);
                document.documentElement.style.setProperty(`--${type.replace('Color', '-color')}`, color);
                document.documentElement.style.setProperty(`--${type.replace('Color', '-rgb')}`, hexToRgb(color));
            };

            const ColorControl = ({ label, value, onChange }) => (
                <div className="mb-3"> 
                    <label className="text-[10px] text-slate-400 mb-1 block uppercase font-bold">{label}</label>
                    <div className="flex items-center gap-2">
                        <div className="relative w-8 h-8 rounded border border-slate-600 overflow-hidden flex-shrink-0">
                            <input type="color" value={value} onChange={(e) => onChange(e.target.value)} className="absolute -top-2 -left-2 w-16 h-16 p-0 border-0 cursor-pointer" />
                        </div>
                        <input type="text" value={value} onChange={(e) => onChange(e.target.value)} className="flex-1 bg-slate-800 border border-slate-700 text-xs px-2 py-1 rounded text-white font-mono uppercase" maxLength={7} />
                    </div>
                </div>
            );

            const RangeControl = ({ label, min, max, step, value, onChange }) => (
                <div className="slider-container">
                    <label className="text-[10px] text-slate-400 block mb-2 flex justify-between uppercase font-bold">
                        <span>{label}</span>
                        <span style={{ color: theme.primaryColor }}>{value}</span>
                    </label>
                    <input type="range" min={min} max={max} step={step} value={value} onChange={onChange} />
                </div>
            );

            const ToggleControl = ({ label, checked, onChange }) => (
                <label className="flex items-center justify-between cursor-pointer group mb-2 p-2 rounded hover:bg-white/5 transition">
                    <span className="text-[10px] text-slate-300 group-hover:text-white transition uppercase font-bold">{label}</span>
                    <div className="relative">
                        <input type="checkbox" checked={checked} onChange={onChange} className="sr-only peer" />
                        <div className="w-9 h-5 bg-slate-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-cyan-500"></div>
                    </div>
                </label>
            );

            return (
                <div className="settings-panel glass-strong" data-aos="zoom-in">
                    <div className="flex justify-between items-center mb-6">
                        <h3 className="text-xl font-bold text-gradient">✨ Theme Settings</h3>
                    </div>

                    <div className="flex gap-1 mb-6 border-b border-slate-700 pb-2">
                        <button onClick={() => setTab('MAIN')} className={`tab-btn ${tab === 'MAIN' ? 'active' : ''}`}>General</button>
                        <button onClick={() => setTab('SATURN')} className={`tab-btn ${tab === 'SATURN' ? 'active' : ''}`}>Saturn</button>
                        <button onClick={() => setTab('COSMOS')} className={`tab-btn ${tab === 'COSMOS' ? 'active' : ''}`}>Cosmos</button>
                        <button onClick={() => setTab('FLUID')} className={`tab-btn ${tab === 'FLUID' ? 'active' : ''}`}>Fluid</button>
                    </div>
                    
                    {tab === 'MAIN' && (
                        <>
                            {['primaryColor', 'secondaryColor'].map(colorType => (
                                <div key={colorType} className="mb-6">
                                    <label className="text-sm text-slate-300 block mb-3 uppercase font-bold">{colorType.replace('Color', ' Color').replace(/([A-Z])/g, ' $1').trim()}</label>
                                    <div className="flex gap-2 flex-wrap mb-3">
                                        {presetColors.map(c => (
                                            <button key={c} className={`color-swatch ${theme[colorType] === c ? 'active' : ''}`} style={{ background: c, color: c }} onClick={() => updateColor(c, colorType)} />
                                        ))}
                                    </div>
                                    <div className="color-picker-wrapper">
                                        <input type="color" value={theme[colorType]} onChange={(e) => updateColor(e.target.value, colorType)} className="cursor-pointer" />
                                    </div>
                                </div>
                            ))}
                            <div className="p-3 bg-slate-800/50 rounded-lg space-y-2">
                                <RangeControl label="Animation Speed" min="0.1" max="3" step="0.1" value={theme.animationSpeed || 1} onChange={(e) => {
                                    const val = parseFloat(e.target.value);
                                    setTheme({ ...theme, animationSpeed: val });
                                    document.documentElement.style.setProperty('--animation-speed', val);
                                }} />
                                <RangeControl label="Glow Intensity" min="0" max="2" step="0.1" value={theme.glowIntensity || 1} onChange={(e) => {
                                    const val = parseFloat(e.target.value);
                                    setTheme({ ...theme, glowIntensity: val });
                                    document.documentElement.style.setProperty('--glow-intensity', val);
                                }} />
                                <ToggleControl label="Space Effects" checked={theme.spaceEffects !== false} onChange={(e) => setTheme({ ...theme, spaceEffects: e.target.checked })} />
                                <ToggleControl label="Cursor Trail" checked={theme.cursorTrail !== false} onChange={(e) => setTheme({ ...theme, cursorTrail: e.target.checked })} />
                            </div>
                        </>
                    )}

                    {tab === 'SATURN' && (
                        <div className="space-y-4">
                            <div className="p-3 bg-slate-800/50 rounded-lg">
                                <h4 className="text-[10px] font-black text-slate-400 mb-2 uppercase tracking-wider border-b border-slate-700 pb-1">Planet Core</h4>
                                <div className="grid grid-cols-2 gap-2">
                                    <ColorControl label="Base" value={theme.pBase} onChange={v => setTheme({...theme, pBase: v})} />
                                    <ColorControl label="Glow" value={theme.pGlow} onChange={v => setTheme({...theme, pGlow: v})} />
                                </div>
                                <RangeControl label="Roughness" min="0" max="1" step="0.1" value={theme.pRough} onChange={e => setTheme({...theme, pRough: parseFloat(e.target.value)})} />
                                <RangeControl label="Metalness" min="0" max="1" step="0.1" value={theme.pMetal} onChange={e => setTheme({...theme, pMetal: parseFloat(e.target.value)})} />
                                <RangeControl label="Rotation Speed" min="0" max="5" step="0.1" value={theme.rotSpeed} onChange={e => setTheme({...theme, rotSpeed: parseFloat(e.target.value)})} />
                            </div>

                            <div className="p-3 bg-slate-800/50 rounded-lg">
                                <h4 className="text-[10px] font-black text-slate-400 mb-2 uppercase tracking-wider border-b border-slate-700 pb-1">Rings</h4>
                                <ToggleControl label="Gyro Pattern" checked={theme.gyroPattern} onChange={e => setTheme({...theme, gyroPattern: e.target.checked})} />
                                <div className="grid grid-cols-3 gap-2 mt-2">
                                    <ColorControl label="Inner" value={theme.r1Col} onChange={v => setTheme({...theme, r1Col: v})} />
                                    <ColorControl label="Mid" value={theme.r2Col} onChange={v => setTheme({...theme, r2Col: v})} />
                                    <ColorControl label="Outer" value={theme.r3Col} onChange={v => setTheme({...theme, r3Col: v})} />
                                </div>
                                <RangeControl label="Thickness" min="0.01" max="0.5" step="0.01" value={theme.rThick} onChange={e => setTheme({...theme, rThick: parseFloat(e.target.value)})} />
                                <RangeControl label="Ring Metal" min="0" max="1" step="0.1" value={theme.rMetal} onChange={e => setTheme({...theme, rMetal: parseFloat(e.target.value)})} />
                            </div>
                        </div>
                    )}

                    {tab === 'COSMOS' && (
                        <div className="space-y-4">
                            <div className="p-3 bg-slate-800/50 rounded-lg">
                                <h4 className="text-[10px] font-black text-slate-400 mb-2 uppercase tracking-wider border-b border-slate-700 pb-1">Environment</h4>
                                <ToggleControl label="Star Field" checked={theme.stars} onChange={e => setTheme({...theme, stars: e.target.checked})} />
                                <ToggleControl label="Asteroid Belt" checked={theme.ast} onChange={e => setTheme({...theme, ast: e.target.checked})} />
                                <ToggleControl label="Data Streams" checked={theme.shoot} onChange={e => setTheme({...theme, shoot: e.target.checked})} />
                                <ToggleControl label="Nebula Clouds" checked={theme.nebula} onChange={e => setTheme({...theme, nebula: e.target.checked})} />
                                <ColorControl label="Nebula Tint" value={theme.nebColor} onChange={v => setTheme({...theme, nebColor: v})} />
                            </div>

                            <div className="p-3 bg-slate-800/50 rounded-lg">
                                <h4 className="text-[10px] font-black text-slate-400 mb-2 uppercase tracking-wider border-b border-slate-700 pb-1">Core Variants</h4>
                                <ToggleControl label="Neutron Core" checked={theme.neutron} onChange={e => setTheme({...theme, neutron: e.target.checked})} />
                                <ToggleControl label="Neptune Core" checked={theme.neptune} onChange={e => setTheme({...theme, neptune: e.target.checked})} />
                                {theme.neptune && (
                                    <div className="grid grid-cols-2 gap-2 mt-2">
                                        <ColorControl label="Core" value={theme.neptuneColA} onChange={v => setTheme({...theme, neptuneColA: v})} />
                                        <ColorControl label="Atmos" value={theme.neptuneColB} onChange={v => setTheme({...theme, neptuneColB: v})} />
                                    </div>
                                )}
                            </div>

                            <div className="p-3 bg-slate-800/50 rounded-lg">
                                <h4 className="text-[10px] font-black text-slate-400 mb-2 uppercase tracking-wider border-b border-slate-700 pb-1">Lightning</h4>
                                <ToggleControl label="Active" checked={theme.lightning} onChange={e => setTheme({...theme, lightning: e.target.checked})} />
                                {theme.lightning && (
                                    <div className="mt-2 space-y-2">
                                        <div className="grid grid-cols-2 gap-2">
                                            <ColorControl label="Bolt A" value={theme.lightningColA} onChange={v => setTheme({...theme, lightningColA: v})} />
                                            <ColorControl label="Bolt B" value={theme.lightningColB} onChange={v => setTheme({...theme, lightningColB: v})} />
                                        </div>
                                        <RangeControl label="Bolt Intensity" min="0.1" max="3.0" step="0.1" value={theme.lightningIntensity} onChange={e => setTheme({...theme, lightningIntensity: parseFloat(e.target.value)})} />
                                    </div>
                                )}
                            </div>
                        </div>
                    )}

                    {tab === 'FLUID' && (
                        <div className="space-y-4">
                            <div className="p-3 bg-slate-800/50 rounded-lg">
                                <h4 className="text-[10px] font-black text-slate-400 mb-2 uppercase tracking-wider border-b border-slate-700 pb-1">Simulation</h4>
                                <ToggleControl label="Active Simulation" checked={theme.fluidEnabled} onChange={e => setTheme({...theme, fluidEnabled: e.target.checked})} />
                                <div className="grid grid-cols-2 gap-2 mt-2">
                                    <ColorControl label="Grad Start" value={theme.fluidColorA} onChange={v => setTheme({...theme, fluidColorA: v})} />
                                    <ColorControl label="Grad End" value={theme.fluidColorB} onChange={v => setTheme({...theme, fluidColorB: v})} />
                                </div>
                            </div>
                            <div className="p-3 bg-slate-800/50 rounded-lg">
                                <h4 className="text-[10px] font-black text-slate-400 mb-2 uppercase tracking-wider border-b border-slate-700 pb-1">Physics</h4>
                                <RangeControl label="Splash Radius" min="0" max="100" step="1" value={theme.fluidRadius} onChange={e => setTheme({...theme, fluidRadius: parseFloat(e.target.value)})} />
                                <RangeControl label="Splash Speed" min="0.1" max="5.0" step="0.1" value={theme.fluidSpeed} onChange={e => setTheme({...theme, fluidSpeed: parseFloat(e.target.value)})} />
                                <RangeControl label="Glow Force" min="1000" max="10000" step="100" value={theme.fluidForce} onChange={e => setTheme({...theme, fluidForce: parseFloat(e.target.value)})} />
                                <RangeControl label="Dissipation" min="0" max="100" step="1" value={theme.fluidDissipation} onChange={e => setTheme({...theme, fluidDissipation: parseFloat(e.target.value)})} />
                            </div>
                        </div>
                    )}

                    <button onClick={() => {
                        const defaultTheme = { 
                            primaryColor: '#06b6d4', secondaryColor: '#a855f7', animationSpeed: 1, glowIntensity: 1, spaceEffects: true, cursorTrail: true,
                            pBase: "#050505", pGlow: "#001133", pRough: 0.2, pMetal: 0.8,
                            r1Col: "#ff0055", r2Col: "#00f0ff", r3Col: "#ccff00", rThick: 0.1, rMetal: 0.9, rRough: 0.1,
                            gyroPattern: true, stars: true, ast: true, shoot: true, nebula: true, nebColor: "#1a0033",
                            neutron: false, neptune: false, neptuneColA: "#0a1a3a", neptuneColB: "#0044aa",
                            lightning: false, lightningColA: "#00f0ff", lightningColB: "#ffffff", lightningIntensity: 1.2, rotSpeed: 1.0,
                            fluidEnabled: true, fluidRes: 128, fluidDissipation: 1.0, fluidForce: 6000, fluidRadius: 40, fluidSpeed: 1.0, fluidColorA: "#00f0ff", fluidColorB: "#ff0055"
                        };
                        setTheme(defaultTheme);
                        Object.entries(defaultTheme).forEach(([k, v]) => {
                            if (k.includes('Color') && !k.includes('fluid')) {
                                document.documentElement.style.setProperty(`--${k.replace('Color', '-color')}`, v);
                                document.documentElement.style.setProperty(`--${k.replace('Color', '-rgb')}`, hexToRgb(v));
                            }
                        });
                        document.documentElement.style.setProperty('--animation-speed', 1);
                        document.documentElement.style.setProperty('--glow-intensity', 1);
                    }} className="w-full py-3 mt-6 text-sm text-slate-400 hover:text-white border border-slate-700 rounded-xl transition-colors hover:border-slate-500">
                        Reset to Default
                    </button>
                </div>
            );
        };

        // === MAIN APP ===
        const App = () => {
            const FORMSPREE_ENDPOINT = "https://formspree.io/f/xzzngoqy";
            const [data, setData] = useState(() => {
                try { return JSON.parse(localStorage.getItem('portfolioData')) || initialData; }
                catch { return initialData; }
            });
            
            const DEFAULT_THEME = { 
                primaryColor: '#06b6d4', secondaryColor: '#a855f7', animationSpeed: 1, glowIntensity: 1, spaceEffects: true, cursorTrail: true,
                // SATURN ASSET CONFIG
                pBase: "#050505", pGlow: "#001133", pRough: 0.2, pMetal: 0.8,
                r1Col: "#ff0055", r2Col: "#00f0ff", r3Col: "#ccff00", rThick: 0.1, rMetal: 0.9, rRough: 0.1,
                gyroPattern: true, stars: true, ast: true, shoot: true, nebula: true, nebColor: "#1a0033", 
                neutron: false, neptune: false, neptuneColA: "#0a1a3a", neptuneColB: "#0044aa",
                lightning: false, lightningColA: "#00f0ff", lightningColB: "#ffffff", lightningIntensity: 1.2,
                rotSpeed: 1.0,
                // FLUID CONFIG
                fluidEnabled: true, fluidRes: 128, fluidDissipation: 1.0, fluidForce: 6000, fluidRadius: 40, fluidSpeed: 1.0, fluidColorA: "#00f0ff", fluidColorB: "#ff0055"
            };

            const [theme, setTheme] = useState(() => {
                try { return { ...DEFAULT_THEME, ...JSON.parse(localStorage.getItem('portfolioTheme')) }; }
                catch { return DEFAULT_THEME; }
            });

            const [isAdmin, setIsAdmin] = useState(false);
            const [viewMode, setViewMode] = useState('visitor');
            const [showLogin, setShowLogin] = useState(false);
            const [loginForm, setLoginForm] = useState({ email: '', pass: '', error: '' });
            const [settingsOpen, setSettingsOpen] = useState(false);
            const [selectedProject, setSelectedProject] = useState(null);
            const [visibleProjects, setVisibleProjects] = useState(6);
            const [mobileMenu, setMobileMenu] = useState(false);
            
            // Modals
            const [editModal, setEditModal] = useState({ open: false });
            const [profileModal, setProfileModal] = useState(false);
            const [cvModal, setCvModal] = useState(false);
            const [addModal, setAddModal] = useState({ open: false, type: null });
            const [addSkillModal, setAddSkillModal] = useState(false);
            const [socialModal, setSocialModal] = useState({ open: false, editItem: null }); // NEW
            const [newSkill, setNewSkill] = useState('');
            const [mediaManager, setMediaManager] = useState({ open: false, projectId: null, type: null });

            const adminMode = isAdmin && viewMode === 'admin';

            // Save theme
            useEffect(() => { localStorage.setItem('portfolioTheme', JSON.stringify(theme)); }, [theme]);

            // Initialize
            useEffect(() => {
                AOS.init({ duration: 800, once: false, offset: 100 });
                
                const dot = document.getElementById('cursor-dot');
                const outline = document.getElementById('cursor-outline');
                let lastX = 0, lastY = 0;

                const moveCursor = (e) => {
                    dot.style.left = `${e.clientX}px`;
                    dot.style.top = `${e.clientY}px`;
                    outline.animate({ left: `${e.clientX}px`, top: `${e.clientY}px` }, { duration: 200, fill: 'forwards' });
                    
                    if (theme.cursorTrail !== false && (Math.abs(e.clientX - lastX) > 25 || Math.abs(e.clientY - lastY) > 25)) {
                        const trail = document.createElement('div');
                        trail.className = 'cursor-trail';
                        trail.style.left = `${e.clientX}px`;
                        trail.style.top = `${e.clientY}px`;
                        document.body.appendChild(trail);
                        setTimeout(() => trail.remove(), 600);
                        lastX = e.clientX; lastY = e.clientY;
                    }
                };

                const handleHover = (e) => {
                    const isInteractive = e.target.closest('a, button, .editable-highlight, input, textarea, .media-editable, [role="button"]');
                    const isTextInput = e.target.closest('input[type="text"], input[type="email"], input[type="password"], textarea');
                    outline.classList.toggle('hover', !!isInteractive && !isTextInput);
                    outline.classList.toggle('text-hover', !!isTextInput);
                };

                const handleClick = (e) => {
                    outline.classList.add('clicking');
                    createClickParticles(e.clientX, e.clientY, [theme.primaryColor, theme.secondaryColor, '#10b981']);
                    setTimeout(() => outline.classList.remove('clicking'), 150);
                };

                window.addEventListener('mousemove', moveCursor);
                window.addEventListener('mousemove', handleHover);
                window.addEventListener('click', handleClick);

                return () => {
                    window.removeEventListener('mousemove', moveCursor);
                    window.removeEventListener('mousemove', handleHover);
                    window.removeEventListener('click', handleClick);
                };
            }, [theme]);

            // Handlers
            const handleLogin = (e) => {
                e.preventDefault();
                if (loginForm.email !== ADMIN_EMAIL) return setLoginForm({...loginForm, error: 'Invalid email'});
                if (loginForm.pass !== ADMIN_PASS) return setLoginForm({...loginForm, error: 'Wrong password'});
                setIsAdmin(true); setViewMode('admin'); setShowLogin(false);
                setLoginForm({ email: '', pass: '', error: '' });
                showToast('Welcome back! 🎉');
            };

            const openEdit = (path, value, type = 'text', label = '', isArray = false) => {
                if (!adminMode) return;
                setEditModal({ open: true, path, value, type, label, isArray });
            };

            const deleteItem = (type, id) => {
                if (!confirm(`Delete this ${type}?`)) return;
                const key = type === 'experience' ? 'experience' : 'projects';
                const newData = { ...data, [key]: data[key].filter(x => x.id !== id) };
                setData(newData);
                localStorage.setItem('portfolioData', JSON.stringify(newData));
                showToast('Deleted!', 'info');
            };

            const deleteSkill = (idx) => {
                const newData = { ...data, skills: data.skills.filter((_, i) => i !== idx) };
                setData(newData);
                localStorage.setItem('portfolioData', JSON.stringify(newData));
                showToast('Removed!', 'info');
            };

            const addSkill = () => {
                if (!newSkill.trim()) return;
                const newData = { ...data, skills: [...data.skills, newSkill.trim()] };
                setData(newData);
                localStorage.setItem('portfolioData', JSON.stringify(newData));
                setNewSkill(''); setAddSkillModal(false);
                showToast('Skill added!');
            };

            const deleteSocial = (id) => {
                if (!confirm('Delete social link?')) return;
                const newData = { ...data, socialLinks: data.socialLinks.filter(s => s.id !== id) };
                setData(newData);
                localStorage.setItem('portfolioData', JSON.stringify(newData));
                showToast('Deleted!', 'info');
            };

            const exportData = () => {
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = 'portfolio-backup.json';
                a.click();
                showToast('Exported! 📦');
            };

            const importData = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (ev) => {
                    try {
                        const imported = JSON.parse(ev.target.result);
                        setData(imported);
                        localStorage.setItem('portfolioData', JSON.stringify(imported));
                        showToast('Imported! 🎉');
                    } catch { showToast('Invalid file!', 'error'); }
                };
                reader.readAsText(file);
            };

            const resetAll = () => {
                if (!confirm('Reset everything? This cannot be undone!')) return;
                setData(initialData);
                localStorage.removeItem('portfolioData');
                showToast('Reset complete!', 'info');
            };

            return (
                <ThemeContext.Provider value={{ theme, setTheme }}>
                    <div className="min-h-screen relative">
                        <FluidLayer theme={theme} />
                        <StarField theme={theme} />
                        <NebulaBackground theme={theme} />

                        {/* NAVBAR */}
                        <nav className="fixed w-full z-50 glass py-4">
                            <div className="container mx-auto px-6 flex justify-between items-center">
                                <div className={`text-2xl font-bold tracking-tight ${adminMode ? 'editable-highlight' : ''}`} onClick={() => openEdit('navBrand.first', data.navBrand?.first, 'text', 'Brand First')}>
                                    <span className="text-gradient">{data.navBrand?.first || 'Junaid'}</span>
                                    <span className="text-white">{data.navBrand?.second || 'Abid'}</span>
                                </div>
                                
                                <div className="hidden md:flex items-center gap-6">
                                    {['Home', 'Experience', 'Skills', 'Projects', 'Contact'].map(item => (
                                        <a key={item} href={`#${item.toLowerCase()}`} className="text-sm font-medium text-slate-300 hover:text-white transition-colors relative group">
                                            {item}
                                            <span className="absolute -bottom-1 left-0 w-0 h-0.5 group-hover:w-full transition-all" style={{ background: theme.primaryColor }} />
                                        </a>
                                    ))}
                                    
                                    {isAdmin && (
                                        <div className="flex gap-1 p-1 rounded-full bg-slate-800/80 ml-4">
                                            <button onClick={() => setViewMode('visitor')} className={`px-4 py-2 rounded-full text-xs font-bold transition-all ${viewMode === 'visitor' ? 'bg-blue-600 text-white' : 'text-slate-400'}`}>👁️ View</button>
                                            <button onClick={() => setViewMode('admin')} className={`px-4 py-2 rounded-full text-xs font-bold transition-all ${viewMode === 'admin' ? 'text-white' : 'text-slate-400'}`} style={viewMode === 'admin' ? { background: `linear-gradient(135deg, ${theme.primaryColor}, ${theme.secondaryColor})` } : {}}>✏️ Edit</button>
                                        </div>
                                    )}
                                    
                                    {!isAdmin ? (
                                        <button onClick={() => setShowLogin(true)} className="px-5 py-2 rounded-full border-2 text-xs font-bold tracking-wider transition-all hover:scale-105" style={{ borderColor: theme.primaryColor, color: theme.primaryColor }}>
                                            🔐 Admin
                                        </button>
                                    ) : (
                                        <button onClick={() => { setIsAdmin(false); setViewMode('visitor'); }} className="px-4 py-2 rounded-full bg-red-600/20 text-red-400 text-xs font-bold hover:bg-red-600/30">Logout</button>
                                    )}
                                </div>

                                <button className="md:hidden text-white text-2xl" onClick={() => setMobileMenu(!mobileMenu)}>
                                    {mobileMenu ? '✕' : '☰'}
                                </button>
                            </div>
                        </nav>

                        {/* Mobile Menu */}
                        {mobileMenu && (
                            <div className="mobile-menu">
                                {['Home', 'Experience', 'Skills', 'Projects', 'Contact'].map(item => (
                                    <a key={item} href={`#${item.toLowerCase()}`} className="text-3xl font-bold text-slate-300 hover:text-white" onClick={() => setMobileMenu(false)}>{item}</a>
                                ))}
                                {!isAdmin && <button onClick={() => { setShowLogin(true); setMobileMenu(false); }} className="text-xl font-bold" style={{ color: theme.primaryColor }}>Admin Login</button>}
                            </div>
                        )}

                        {/* Floating Admin Panel */}
                        {adminMode && (
                            <div className="floating-admin-panel hidden lg:flex">
                                <button className="fab-btn bg-green-600 text-white" data-tooltip="Add Experience" onClick={() => setAddModal({ open: true, type: 'experience' })}>➕</button>
                                <button className="fab-btn bg-purple-600 text-white" data-tooltip="Add Project" onClick={() => setAddModal({ open: true, type: 'project' })}>📁</button>
                                <button className="fab-btn bg-blue-600 text-white" data-tooltip="Add Skill" onClick={() => setAddSkillModal(true)}>🏷️</button>
                                <button className="fab-btn bg-orange-600 text-white" data-tooltip="Upload CV" onClick={() => setCvModal(true)}>📄</button>
                                <button className="fab-btn bg-teal-600 text-white" data-tooltip="Export Data" onClick={exportData}>📤</button>
                                <label className="fab-btn bg-indigo-600 text-white" data-tooltip="Import Data">📥<input type="file" accept=".json" className="hidden" onChange={importData} /></label>
                                <button className="fab-btn bg-red-600 text-white" data-tooltip="Reset All" onClick={resetAll}>🔄</button>
                            </div>
                        )}

                        {/* Admin Mode Banner */}
                        {adminMode && (
                            <div className="fixed top-20 left-1/2 -translate-x-1/2 z-40 px-6 py-3 rounded-full font-bold text-sm shimmer-text glass-strong border" style={{ borderColor: theme.primaryColor }}>
                                ✨ ADMIN MODE — Click highlighted elements to edit
                            </div>
                        )}

                        {/* MODALS */}
                        {showLogin && (
                            <div className="modal-overlay">
                                <div className="glass-strong p-10 rounded-3xl w-[420px] relative">
                                    <button onClick={() => setShowLogin(false)} className="absolute top-4 right-4 text-slate-400 hover:text-white text-2xl">✕</button>
                                    <h2 className="text-3xl font-bold mb-8 text-center text-gradient">🔐 Admin Access</h2>
                                    <form onSubmit={handleLogin} className="space-y-5">
                                        <input type="email" placeholder="Email" className="w-full bg-slate-800 border-2 border-slate-600 rounded-xl p-4 text-white outline-none focus:border-cyan-400" value={loginForm.email} onChange={(e) => setLoginForm({...loginForm, email: e.target.value})} />
                                        <input type="password" placeholder="Password" className="w-full bg-slate-800 border-2 border-slate-600 rounded-xl p-4 text-white outline-none focus:border-cyan-400" value={loginForm.pass} onChange={(e) => setLoginForm({...loginForm, pass: e.target.value})} />
                                        {loginForm.error && <p className="text-red-500 text-center text-sm">{loginForm.error}</p>}
                                        <button type="submit" className="w-full py-4 rounded-xl font-bold text-lg transition-all hover:scale-105 shadow-glow" style={{ background: `linear-gradient(135deg, ${theme.primaryColor}, ${theme.secondaryColor})` }}>Login</button>
                                    </form>
                                </div>
                            </div>
                        )}

                        <EditModal editModal={editModal} setEditModal={setEditModal} data={data} setData={setData} theme={theme} />
                        <SocialLinkModal isOpen={socialModal.open} onClose={() => setSocialModal({open: false, editItem: null})} data={data} setData={setData} theme={theme} editingLink={socialModal.editItem} />
                        {profileModal && <ProfileImageModal isOpen onClose={() => setProfileModal(false)} data={data} setData={setData} theme={theme} />}
                        {cvModal && <CVModal isOpen onClose={() => setCvModal(false)} data={data} setData={setData} theme={theme} />}
                        {addModal.open && <AddItemModal type={addModal.type} isOpen onClose={() => setAddModal({ open: false })} data={data} setData={setData} theme={theme} />}
                        {selectedProject && <ProjectModal project={selectedProject} onClose={() => setSelectedProject(null)} isAdmin={adminMode} theme={theme} data={data} setData={setData} openEdit={openEdit} />}
                        {mediaManager.open && <MediaManagerModal isOpen onClose={() => setMediaManager({ open: false })} projectId={mediaManager.projectId} mediaType={mediaManager.type} data={data} setData={setData} theme={theme} />}

                        {/* Add Skill Modal */}
                        {addSkillModal && (
                            <div className="modal-overlay" onClick={() => setAddSkillModal(false)}>
                                <div className="glass-strong p-8 rounded-3xl w-full max-w-md" onClick={e => e.stopPropagation()}>
                                    <h2 className="text-xl font-bold mb-6 text-gradient">🏷️ Add Skill</h2>
                                    <input placeholder="Skill name" className="w-full bg-slate-800 border border-slate-600 rounded-xl p-4 text-white outline-none mb-6" value={newSkill} onChange={e => setNewSkill(e.target.value)} onKeyDown={e => e.key === 'Enter' && addSkill()} />
                                    <div className="flex gap-4">
                                        <button onClick={() => setAddSkillModal(false)} className="flex-1 py-3 bg-slate-700 rounded-xl font-bold">Cancel</button>
                                        <button onClick={addSkill} className="flex-1 py-3 rounded-xl font-bold" style={{ background: `linear-gradient(135deg, ${theme.primaryColor}, ${theme.secondaryColor})` }}>Add</button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* MAIN CONTENT */}
                        <main className="pt-20 relative z-10">
                            {/* Hero */}
                            <section id="home" className="min-h-screen flex items-center py-20">
                                <div className="container mx-auto px-6 grid lg:grid-cols-2 gap-16 items-center">
                                    <div data-aos="fade-right">
                                        <p className={`font-mono text-lg mb-3 ${adminMode ? 'editable-highlight' : ''}`} style={{ color: theme.primaryColor }} onClick={() => openEdit('heroGreeting', data.heroGreeting, 'text', 'Greeting')}>
                                            {data.heroGreeting}
                                        </p>
                                        <h1 className={`text-5xl lg:text-7xl font-extrabold text-white mb-4 leading-tight ${adminMode ? 'editable-highlight' : ''}`} onClick={() => openEdit('name', data.name, 'text', 'Name')}>
                                            {data.name}
                                        </h1>
                                        <h2 className={`text-2xl lg:text-3xl font-light text-slate-300 mb-3 ${adminMode ? 'editable-highlight' : ''}`} onClick={() => openEdit('role', data.role, 'text', 'Role')}>
                                            {data.role}
                                        </h2>
                                        <p className={`shimmer-text text-xl font-semibold mb-6 ${adminMode ? 'editable-highlight' : ''}`} onClick={() => openEdit('tagline', data.tagline, 'text', 'Tagline')}>
                                            {data.tagline}
                                        </p>
                                        <p className={`text-slate-400 max-w-xl mb-10 leading-relaxed text-lg ${adminMode ? 'editable-highlight' : ''}`} onClick={() => openEdit('summary', data.summary, 'textarea', 'Summary')}>
                                            {data.summary}
                                        </p>
                                        
                                        <div className="flex gap-5 flex-wrap mb-8">
                                            <a href="#contact" className="magnetic-btn px-10 py-4 text-white rounded-2xl font-bold shadow-glow transition-all hover:scale-105 text-lg" style={{ background: `linear-gradient(135deg, ${theme.primaryColor}, ${theme.secondaryColor})` }}>
                                                Contact Me ✨
                                            </a>
                                            {data.cvUrl ? (
                                                <a href={data.cvUrl} download={data.cvFileName} className="magnetic-btn px-10 py-4 glass hover:bg-slate-800 text-white rounded-2xl font-bold transition-all text-lg">
                                                    📄 Download CV
                                                </a>
                                            ) : (
                                                <button onClick={() => adminMode && setCvModal(true)} className="magnetic-btn px-10 py-4 glass hover:bg-slate-800 text-white rounded-2xl font-bold transition-all text-lg">
                                                    {adminMode ? '📤 Upload CV' : '📄 Download CV'}
                                                </button>
                                            )}
                                        </div>

                                        <div className="flex gap-4">
                                            {data.socialLinks?.map(link => (
                                                <a key={link.id} href={link.url} target="_blank" className="social-link" title={link.label}>
                                                    <i className={link.icon}></i>
                                                </a>
                                            ))}
                                        </div>
                                    </div>
                                    
                                    <div data-aos="zoom-in" className="flex justify-center">
                                        <div className="profile-image-container relative w-80 h-80 rounded-full float-animation" style={{ boxShadow: `0 0 60px ${theme.primaryColor}40` }}>
                                            <div className="absolute inset-0 rounded-full" style={{ background: `linear-gradient(135deg, ${theme.primaryColor}40, ${theme.secondaryColor}40)`, padding: '4px' }}>
                                                <img src={data.profileImage || `https://ui-avatars.com/api/?name=${data.name?.replace(' ', '+') || 'User'}&background=0f172a&color=06b6d4&size=500`} alt="" className="w-full h-full object-cover rounded-full" />
                                            </div>
                                            {adminMode && (
                                                <div className="profile-overlay">
                                                    <button onClick={() => setProfileModal(true)} className="px-6 py-3 rounded-xl font-bold" style={{ background: `linear-gradient(135deg, ${theme.primaryColor}, ${theme.secondaryColor})` }}>📷 Change</button>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            </section>

                            {/* Experience */}
                            <section id="experience" className="py-24">
                                <div className="container mx-auto px-6 max-w-5xl">
                                    <h2 className={`text-4xl lg:text-5xl font-bold text-center mb-4 text-glow ${adminMode ? 'editable-highlight' : ''}`} onClick={() => openEdit('sectionHeaders.experience', data.sectionHeaders?.experience, 'text', 'Header')}>
                                        {data.sectionHeaders?.experience}
                                    </h2>
                                    <p className={`text-slate-400 text-center mb-16 text-lg ${adminMode ? 'editable-highlight' : ''}`} onClick={() => openEdit('sectionHeaders.experienceSubtitle', data.sectionHeaders?.experienceSubtitle, 'text', 'Subtitle')}>
                                        {data.sectionHeaders?.experienceSubtitle}
                                    </p>

                                    <div className="space-y-8">
                                        {data.experience?.map((job, idx) => (
                                            <div key={job.id} className={`glass p-8 rounded-3xl transition-all hover:shadow-glow-hover relative group ${adminMode ? '' : ''}`} data-aos="fade-up" data-aos-delay={idx * 100}>
                                                {adminMode && <button className="delete-btn" onClick={() => deleteItem('experience', job.id)}>×</button>}
                                                
                                                <div className="flex flex-col lg:flex-row justify-between gap-4 mb-4">
                                                    <div>
                                                        <h3 className={`text-2xl font-bold text-white ${adminMode ? 'editable-highlight' : ''}`} onClick={() => openEdit(`experience.${idx}.role`, job.role, 'text', 'Role')}>
                                                            {job.role}
                                                        </h3>
                                                        <p className={`font-medium ${adminMode ? 'editable-highlight' : ''}`} style={{ color: theme.primaryColor }} onClick={() => openEdit(`experience.${idx}.company`, job.company, 'text', 'Company')}>
                                                            {job.company} {job.location && `• ${job.location}`}
                                                        </p>
                                                    </div>
                                                    <span className={`text-slate-400 text-sm bg-slate-800/70 px-4 py-2 rounded-full h-fit ${adminMode ? 'editable-highlight' : ''}`} onClick={() => openEdit(`experience.${idx}.period`, job.period, 'text', 'Period')}>
                                                        {job.period}
                                                    </span>
                                                </div>
                                                
                                                <p className={`text-slate-300 leading-relaxed mb-4 ${adminMode ? 'editable-highlight' : ''}`} onClick={() => openEdit(`experience.${idx}.desc`, job.desc, 'textarea', 'Description')}>
                                                    {job.desc}
                                                </p>

                                                {job.highlights?.length > 0 && (
                                                    <div className="flex flex-wrap gap-2">
                                                        {job.highlights.map((h, i) => (
                                                            <span key={i} className="skill-tag text-xs px-3 py-1 rounded-full">{h}</span>
                                                        ))}
                                                    </div>
                                                )}
                                            </div>
                                        ))}

                                        {adminMode && <button onClick={() => setAddModal({ open: true, type: 'experience' })} className="add-btn w-full">➕ Add Experience</button>}
                                    </div>
                                </div>
                            </section>

                            {/* Skills */}
                            <section id="skills" className="py-24 bg-slate-900/50">
                                <div className="container mx-auto px-6">
                                    <h2 className={`text-4xl lg:text-5xl font-bold text-center mb-4 text-glow ${adminMode ? 'editable-highlight' : ''}`} onClick={() => openEdit('sectionHeaders.skills', data.sectionHeaders?.skills, 'text', 'Header')}>
                                        {data.sectionHeaders?.skills}
                                    </h2>
                                    <p className={`text-slate-400 text-center mb-16 text-lg ${adminMode ? 'editable-highlight' : ''}`} onClick={() => openEdit('sectionHeaders.skillsSubtitle', data.sectionHeaders?.skillsSubtitle, 'text', 'Subtitle')}>
                                        {data.sectionHeaders?.skillsSubtitle}
                                    </p>

                                    <div className="flex flex-wrap justify-center gap-4 max-w-5xl mx-auto">
                                        {data.skills?.map((skill, idx) => (
                                            <span key={idx} className={`px-7 py-4 glass rounded-2xl font-semibold text-lg border border-slate-700 transition-all relative group ${adminMode ? 'editable-highlight' : ''}`} style={{ color: theme.primaryColor }} onClick={() => openEdit(`skills.${idx}`, skill, 'text', 'Skill')} data-aos="zoom-in" data-aos-delay={idx * 40}>
                                                {skill}
                                                {adminMode && <button className="delete-btn" onClick={(e) => { e.stopPropagation(); deleteSkill(idx); }}>×</button>}
                                            </span>
                                        ))}
                                        {adminMode && (
                                            <button onClick={() => setAddSkillModal(true)} className="px-7 py-4 rounded-2xl font-semibold text-lg border-2 border-dashed transition-all hover:border-solid" style={{ borderColor: theme.primaryColor, color: theme.primaryColor }}>
                                                + Add Skill
                                            </button>
                                        )}
                                    </div>
                                </div>
                            </section>

                            {/* Projects */}
                            <section id="projects" className="py-24">
                                <div className="container mx-auto px-6">
                                    <h2 className={`text-4xl lg:text-5xl font-bold text-center mb-4 text-glow ${adminMode ? 'editable-highlight' : ''}`} onClick={() => openEdit('sectionHeaders.projects', data.sectionHeaders?.projects, 'text', 'Header')}>
                                        {data.sectionHeaders?.projects}
                                    </h2>
                                    <p className={`text-slate-400 text-center mb-16 text-lg max-w-2xl mx-auto ${adminMode ? 'editable-highlight' : ''}`} onClick={() => openEdit('sectionHeaders.projectsSubtitle', data.sectionHeaders?.projectsSubtitle, 'textarea', 'Subtitle')}>
                                        {data.sectionHeaders?.projectsSubtitle}
                                    </p>

                                    <div className="projects-grid max-w-7xl mx-auto">
                                        {data.projects?.slice(0, visibleProjects).map(project => (
                                            <ProjectCard key={project.id} project={project} onClick={() => setSelectedProject(project)} isAdmin={adminMode} theme={theme}
                                                onManageImages={() => setMediaManager({ open: true, projectId: project.id, type: 'images' })}
                                                onDelete={() => deleteItem('project', project.id)} />
                                        ))}
                                    </div>

                                    {adminMode && (
                                        <div className="max-w-7xl mx-auto mt-8">
                                            <button onClick={() => setAddModal({ open: true, type: 'project' })} className="add-btn w-full">➕ Add Project</button>
                                        </div>
                                    )}

                                    {visibleProjects < (data.projects?.length || 0) && (
                                        <div className="text-center mt-12">
                                            <button onClick={() => setVisibleProjects(p => p + 6)} className="px-10 py-4 rounded-2xl font-bold transition-all hover:scale-105" style={{ background: `${theme.primaryColor}20`, color: theme.primaryColor, border: `2px solid ${theme.primaryColor}50` }}>
                                                Load More ({(data.projects?.length || 0) - visibleProjects} more)
                                            </button>
                                        </div>
                                    )}
                                </div>
                            </section>

                            {/* Contact with Planet Effect - UPDATED SECTION */}
                            <section id="contact" className="py-24 relative flex items-center justify-center">
                                <div className="container mx-auto px-6 max-w-7xl">
                                    <div className="grid lg:grid-cols-2 gap-16 items-center">
                                        
                                        {/* LEFT: ADVANCED PLANET + TITLES */}
                                        <div className="h-[600px] relative flex flex-col justify-center" data-aos="fade-right">
                                            <div className="absolute top-0 w-full text-center lg:text-left z-10 pointer-events-none">
                                                <h2 className={`text-5xl font-extrabold text-white mb-2 pointer-events-auto ${adminMode ? 'editable-highlight' : ''}`} onClick={() => openEdit('sectionHeaders.contactTitle', data.sectionHeaders?.contactTitle, 'text', 'Title')}>
                                                    {data.sectionHeaders?.contactTitle}
                                                </h2>
                                                <p className={`text-xl text-slate-400 pointer-events-auto ${adminMode ? 'editable-highlight' : ''}`} onClick={() => openEdit('sectionHeaders.contactSubtitle', data.sectionHeaders?.contactSubtitle, 'text', 'Subtitle')}>
                                                    {data.sectionHeaders?.contactSubtitle}
                                                </p>
                                            </div>
                                            {/* Advanced Saturn Scene from Asset */}
                                            <AdvancedSaturn theme={theme} />
                                        </div>

                                        {/* RIGHT: CONTACT FORM */}
                                        <div className="glass p-8 lg:p-12 rounded-3xl shadow-2xl relative z-10" data-aos="fade-left">
                                            <div className="mb-8">
                                                <div className="flex items-center gap-4 mb-4">
                                                    <div className="w-12 h-12 rounded-full bg-slate-800 flex items-center justify-center text-2xl text-cyan-400">📍</div>
                                                    <div>
                                                        <p className="text-sm text-slate-400">Location</p>
                                                        <p className={`font-medium text-white text-lg ${adminMode ? 'editable-highlight' : ''}`} onClick={() => openEdit('location', data.location, 'text', 'Location')}>{data.location}</p>
                                                    </div>
                                                </div>
                                                <div className="flex items-center gap-4">
                                                    <div className="w-12 h-12 rounded-full bg-slate-800 flex items-center justify-center text-2xl text-cyan-400">📧</div>
                                                    <div>
                                                        <p className="text-sm text-slate-400">Email</p>
                                                        <p className={`font-medium text-white text-lg ${adminMode ? 'editable-highlight' : ''}`} onClick={() => openEdit('email', data.email, 'text', 'Email')}>{data.email}</p>
                                                    </div>
                                                </div>
                                            </div>

                                            <form action={FORMSPREE_ENDPOINT} method="POST" className="space-y-6">
                                                <div>
                                                    <label className="text-sm font-bold text-slate-400 mb-2 block">Name</label>
                                                    <input type="text" name="name" required className="w-full bg-slate-900/50 border border-slate-700 rounded-xl p-4 text-white focus:border-cyan-500 outline-none transition-all" placeholder="Your Name" />
                                                </div>
                                                <div>
                                                    <label className="text-sm font-bold text-slate-400 mb-2 block">Email</label>
                                                    <input type="email" name="email" required className="w-full bg-slate-900/50 border border-slate-700 rounded-xl p-4 text-white focus:border-cyan-500 outline-none transition-all" placeholder="your.email@example.com" />
                                                </div>
                                                <div>
                                                    <label className="text-sm font-bold text-slate-400 mb-2 block">Message</label>
                                                    <textarea name="message" rows="4" required className="w-full bg-slate-900/50 border border-slate-700 rounded-xl p-4 text-white focus:border-cyan-500 outline-none transition-all resize-none" placeholder="Hello..."></textarea>
                                                </div>
                                                <button type="submit" className="btn-electric w-full py-4 rounded-xl font-bold text-white text-lg shadow-lg">Send Message 🚀</button>
                                            </form>

                                            <div className="mt-8 pt-8 border-t border-slate-700">
                                                <div className="flex flex-wrap gap-4 justify-center items-center">
                                                    {data.socialLinks?.map(link => (
                                                        <div key={link.id} className="relative group">
                                                            <a href={link.url} target="_blank" className="social-icon-btn w-12 h-12 rounded-full bg-slate-800 flex items-center justify-center text-xl text-slate-400 hover:bg-slate-700 transition-all">
                                                                <i className={link.icon}></i>
                                                            </a>
                                                            {adminMode && (
                                                                <>
                                                                    <div className="icon-edit-overlay bg-blue-500" style={{ right: 15 }} onClick={(e) => { e.preventDefault(); setSocialModal({ open: true, editItem: link }); }}>✎</div>
                                                                    <div className="icon-edit-overlay bg-red-500" onClick={(e) => { e.preventDefault(); deleteSocial(link.id); }}>×</div>
                                                                </>
                                                            )}
                                                        </div>
                                                    ))}
                                                    
                                                    {adminMode && (
                                                        <button onClick={() => setSocialModal({ open: true, editItem: null })} className="social-icon-btn w-12 h-12 rounded-full border-2 border-dashed border-slate-600 flex items-center justify-center text-xl text-slate-400 hover:border-cyan-500 hover:text-cyan-500 transition-all">
                                                            +
                                                        </button>
                                                    )}
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </section>
                        </main>

                        {/* Footer */}
                        <footer className="py-12 text-center glass mt-16">
                            <p className="text-slate-400 mb-2">© {new Date().getFullYear()} {data.name}. All rights reserved.</p>
                            <p className={`text-slate-500 text-sm ${adminMode ? 'editable-highlight' : ''}`} onClick={() => openEdit('footerText', data.footerText, 'text', 'Footer')}>
                                {data.footerText}
                            </p>
                        </footer>

                        {/* Settings */}
                        <div className="settings-wheel">
                            <SettingsPanel isOpen={settingsOpen} theme={theme} setTheme={setTheme} />
                            <button className="settings-btn" onClick={() => setSettingsOpen(!settingsOpen)} style={{ color: theme.primaryColor }}>
                                {settingsOpen ? '✕' : '⚙️'}
                            </button>
                        </div>
                    </div>
                </ThemeContext.Provider>
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
